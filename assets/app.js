var app=angular.module("app",["ngRoute","ui.router","ngCookies"]);angular.module("app").factory("authInterceptor",["$window",function(o){return{request:function(e){return e.headers=e.headers||{},o.localStorage.token&&(e.headers.Authorization=o.localStorage.token),e}}}]).config(["$routeProvider","$httpProvider",function(o,e){e.interceptors.push("authInterceptor"),o.when("/",{templateUrl:"/main"}).when("/signup",{templateUrl:"/signup"}).when("/signin",{templateUrl:"/signin"}).when("/userinfo",{templateUrl:"/userinfo"}).when("/successfulSignup",{templateUrl:"/successfulSignup"}).when("/offer",{templateUrl:"/offer"}).when("/confirmation",{templateUrl:"/confirmation"}).otherwise("/")}]),angular.module("app").controller("authCtrl",["$q","$scope","$window","$location","$route","$rootScope","AuthService",function(o,e,t,n,r,a,i){e.regex="(\\+[0-9]\\d{1})*(\\s)*([0-9]\\d{2})(\\s*)([0-9]\\d{2})(\\s*)([0-9]\\d{2})",e.submitError=!1,e.errorMessage="",a.isLoggedIn=function(){return i.isAuthenticated},e.signin=function(){console.log("login"),i.signin(e.user).then(function(o,e){a.isLogedIn=!0,t.location.reload(),console.log(o)})},e.signout=function(){i.signout(),a.isLogedIn=!1,t.location.reload(),console.log("logout")},e.getUserInfo=function(){i.getUserInfo().then(function(o){console.log(o),e.userinfo=o})},e.submitForm=function(o){o?i.signup(e.user).then(function(o){console.log("Pomyślnie zarejestrowano"),e.submitError=!1,i.signin(e.user).then(function(o,e){a.isLogedIn=!0,"http://localhost:3001/#/confirmation"==t.location.toString()?t.location.reload():t.location.href="#/successfulSignup"})},function(o){switch(console.log(o),o.code){case 11e3:e.submitError=!0,e.errorMessage="Wybrany email jest już zarejestrowany. Proszę wybrać inny.";break;default:e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później."}}):(e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później.")},e.$watch("submitError",function(o){console.log(o)})}]),angular.module("app").controller("confirmationCtrl",["$q","$window","$location","$cookies","$scope","$rootScope","AuthService",function(o,e,t,n,r,a,i){r.isSignedIn=!1,r.room=JSON.parse(n.get("room")),r.dateFrom=JSON.parse(n.get("dates")).dateFrom,r.dateTo=JSON.parse(n.get("dates")).dateTo,r.extras=JSON.parse(n.get("extras")).extras,r.numOfDays=JSON.parse(n.get("extras")).numOfDays;var s=function(){i.isAuthenticated?r.isSignedIn=!0:r.isSignedIn=!1};s()}]),angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(o,e,t,n){n.$validators.compareTo=function(e){return e==o.otherModelValue},o.$watch("otherModelValue",function(){n.$validate()})}}}),angular.module("app").controller("offerCtrl",["$scope","$cookies","$location","$window","offerSvc",function(o,e,t,n,r){o.offer={},o.extras=[],o.selectedExtras=[];var a={};o.dateFrom="",o.dateTo="",o.roomName="";var i=function(){o.offer=JSON.parse(e.get("room")),o.extras=u(),a=JSON.parse(e.get("dates")),o.dateFrom=s(new Date(a.dateFrom)),o.dateTo=s(new Date(a.dateTo)),o.roomName=o.offer.type,o.roomPrice=o.offer.price,o.extrasTotalPrice=0},s=function(o){var e=o.getUTCDate(),t=o.getUTCMonth()+1,n=o.getUTCFullYear();return""+e+"-"+t+"-"+n};o.addOrRemoveExtra=function(e){var t=o.selectedExtras.indexOf(e);e.buttonText=e.buttonToggle?"Dodaj +":"Usuń -",e.buttonToggle=!e.buttonToggle,t==-1?(o.selectedExtras.push(e),o.extrasTotalPrice+=e.price*c()):(o.selectedExtras.splice(t,1),o.extrasTotalPrice-=e.price*c())},o.toConfirmation=function(){console.log("asdasd");var t={extras:o.selectedExtras,numOfDays:c()};e.put("extras",JSON.stringify(t)),n.location.href="#/confirmation"},o.toPrevious=function(){n.location.href="#/main"};var u=function(){r.getExtras().then(function(e){o.extras=e;for(var t=0;t<o.extras.length;t++)o.extras[t].buttonText="Dodaj +",o.extras[t].buttonToggle=!1})},c=function(){var o=864e5,e=new Date(a.dateFrom),t=new Date(a.dateTo),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((r-n)/o)};i()}]),angular.module("app").controller("roomCtrl",["$q","$cookies","$scope","$window","$location","roomService","offerSvc","$filter",function(o,e,t,n,r,a,i,s){t.dateFrom="",t.dateTo="",t.noRoomsError=!1,t.errorMsg="",t.rooms=[],t.numberOfBeds=1;var u=function(){var o=new Date;console.log(o),t.dateFrom=o;var e=new Date;e.setDate(e.getDate()+1),t.dateTo=e};t.init=function(){u(),t.findRooms()},t.findRooms=function(){a.getRooms({from:t.dateFrom.toISOString(),to:t.dateTo.toISOString(),beds:t.numberOfBeds}).then(function(o){t.rooms=o},function(o){t.noRoomsError=!0,t.errorMsg="Coś poszło nie tak."})},t.addRoom=function(o){e.put("room",JSON.stringify(o)),e.put("dates",JSON.stringify({dateFrom:t.dateFrom,dateTo:t.dateTo})),i.chooseRoom(o),n.location.href="#/offer"},t.test=function(){console.log(t.rooms),t.findRooms()}}]),angular.module("app").filter("uniqueCategories",function(){return function(o,e){if(angular.isArray(o)){for(var t=[],n={},r=0;r<o.length;r++){var a=o[r][e];angular.isUndefined(n[a])&&(n[a]=!0,t.push(o[r]))}return t}return o}}),angular.module("app").service("AuthService",["$http","$q",function(o,e){function t(){var o=window.localStorage.getItem(s);console.log("loading User info..."),o&&a(o)}function n(){i=void 0,u=!1,o.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(s)}function r(o){window.localStorage.setItem(s,o),a(o)}function a(e){u=!0,i=e,o.defaults.headers.common.Authorization=i}var i,s="token",u=!1,c=function(t){return e(function(e,n){o.post("/api/authenticate",t).then(function(o){o.data.success?(r(o.data.token),e(o.data.msg,o.data.success)):n(o.data.msg,o.data.success)})})},l=function(){n()},f=function(t){return e(function(e,n){o.post("/api/signup",t).then(function(o){o.data.success?(console.log("jestem w resolve"),e(o.data.msg)):n(o.data.msg)})})};t();var d=function(){return e(function(e,t){o.get("/api/userinfo").then(function(o){o.data.success?e(o.data.msg):t(o.data.msg)})})};return{signin:c,signout:l,signup:f,getUserInfo:d,isAuthenticated:u}}]),angular.module("app").service("offerSvc",["$q","$http",function(o,e){var t=function(o){choosenRoom=o},n=function(){return choosenRoom},r=function(){return o(function(o,t){e.get("/api/getExtras").then(function(e){e.data.success?o(e.data.extras):t(e.data.error)})})};return{chooseRoom:t,getRoom:n,getExtras:r}}]),angular.module("app").service("roomService",["$q","$http",function(o,e){var t=function(t){return o(function(o,n){e.post("/api/findRooms",t).then(function(e){e.data.success?(console.log("Pobrano pokoje"),o(e.data.rooms)):n(e.data.error)})})};return{getRooms:t}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbmZpZy5qcyIsImNvbnRyb2xsZXJzL2F1dGhvcml6YXRpb24uanMiLCJjb250cm9sbGVycy9jb25maXJtYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvZGlyZWN0aXZlcy5qcyIsImNvbnRyb2xsZXJzL29mZmVyQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3Jvb21Db250cm9sbGVyLmpzIiwiZmlsbHRlcnMvcm9vbUZpbHRlci5qcyIsInNlcnZpY2VzL2F1dGhvcml6YXRpb24uc3ZjLmpzIiwic2VydmljZXMvb2ZmZXIuc3ZjLmpzIiwic2VydmljZXMvcm9vbS5zdmMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImZhY3RvcnkiLCIkd2luZG93IiwicmVxdWVzdCIsImNvbmZpZyIsImhlYWRlcnMiLCJsb2NhbFN0b3JhZ2UiLCJ0b2tlbiIsIiRyb3V0ZVByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJjb250cm9sbGVyIiwiJHEiLCIkc2NvcGUiLCIkbG9jYXRpb24iLCIkcm91dGUiLCIkcm9vdFNjb3BlIiwiQXV0aFNlcnZpY2UiLCJyZWdleCIsInN1Ym1pdEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaXNMb2dnZWRJbiIsImlzQXV0aGVudGljYXRlZCIsInNpZ25pbiIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyIiwidGhlbiIsIm1zZyIsInN1Y2Nlc3MiLCJpc0xvZ2VkSW4iLCJsb2NhdGlvbiIsInJlbG9hZCIsInNpZ25vdXQiLCJnZXRVc2VySW5mbyIsInVzZXJpbmZvIiwic3VibWl0Rm9ybSIsImlzVmFsaWQiLCJzaWdudXAiLCJkYXRhIiwidG9TdHJpbmciLCJocmVmIiwiY29kZSIsIiR3YXRjaCIsIiRjb29raWVzIiwiaXNTaWduZWRJbiIsInJvb20iLCJKU09OIiwicGFyc2UiLCJnZXQiLCJkYXRlRnJvbSIsImRhdGVUbyIsImV4dHJhcyIsIm51bU9mRGF5cyIsImluaXQiLCJkaXJlY3RpdmUiLCJyZXF1aXJlIiwic2NvcGUiLCJvdGhlck1vZGVsVmFsdWUiLCJsaW5rIiwiZWxlbWVudCIsImF0dHJpYnV0ZXMiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJjb21wYXJlVG8iLCJtb2RlbFZhbHVlIiwiJHZhbGlkYXRlIiwib2ZmZXJTdmMiLCJvZmZlciIsInNlbGVjdGVkRXh0cmFzIiwiZGF0ZXMiLCJyb29tTmFtZSIsInNob3dPZmZlciIsImdldEV4dHJhcyIsImRhdGVQcmVldGlmeSIsIkRhdGUiLCJ0eXBlIiwicm9vbVByaWNlIiwicHJpY2UiLCJleHRyYXNUb3RhbFByaWNlIiwiZGF0ZSIsImRheSIsImdldFVUQ0RhdGUiLCJtb250aCIsImdldFVUQ01vbnRoIiwieWVhciIsImdldFVUQ0Z1bGxZZWFyIiwiYWRkT3JSZW1vdmVFeHRyYSIsImV4dHJhIiwiaW5kZXgiLCJpbmRleE9mIiwiYnV0dG9uVGV4dCIsImJ1dHRvblRvZ2dsZSIsImNhbGN1bGF0ZURpZmZPZkRheXMiLCJzcGxpY2UiLCJ0b0NvbmZpcm1hdGlvbiIsInB1dCIsInN0cmluZ2lmeSIsInRvUHJldmlvdXMiLCJleHRyYXNEYXRhIiwiaSIsImxlbmd0aCIsIk1TX1BFUl9EQVkiLCJkYXRlRnJvbVVUQyIsIlVUQyIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZGF0ZVRvVVRDIiwiTWF0aCIsImZsb29yIiwicm9vbVNlcnZpY2UiLCIkZmlsdGVyIiwibm9Sb29tc0Vycm9yIiwiZXJyb3JNc2ciLCJyb29tcyIsIm51bWJlck9mQmVkcyIsInNldERhdGUiLCJkYXRlVGVtcCIsImZpbmRSb29tcyIsImdldFJvb21zIiwiZnJvbSIsInRvSVNPU3RyaW5nIiwidG8iLCJiZWRzIiwicm9vbXNEYXRhIiwiZXJyb3IiLCJhZGRSb29tIiwiY2hvb3NlUm9vbSIsInRlc3QiLCJmaWx0ZXIiLCJwcm9wZXJ0eU5hbWUiLCJpc0FycmF5IiwicmVzdWx0Iiwia2V5cyIsInZhbCIsImlzVW5kZWZpbmVkIiwic2VydmljZSIsIiRodHRwIiwibG9hZFVzZXJJbmZvIiwid2luZG93IiwiZ2V0SXRlbSIsIkxPQ0FMX1RPS0VOIiwidXNlckluZm8iLCJkZXN0cm95VXNlckluZm8iLCJhdXRoVG9rZW4iLCJ1bmRlZmluZWQiLCJkZWZhdWx0cyIsImNvbW1vbiIsInJlbW92ZUl0ZW0iLCJzdG9yZVVzZXJJbmZvIiwic2V0SXRlbSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0IiwiY2hvb3NlblJvb20iLCJnZXRSb29tIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsVUFBQSxZQUFBLGFDQUFELFNBQUFDLE9BQUEsT0FDQUMsUUFBQSxtQkFBQSxVQUFBLFNBQUFDLEdBQ0EsT0FDQUMsUUFBQSxTQUFBQyxHQU1BLE1BTEFBLEdBQUFDLFFBQUFELEVBQUFDLFlBQ0FILEVBQUFJLGFBQUFDLFFBQ0FILEVBQUFDLFFBQUEsY0FBQUgsRUFBQUksYUFBQUMsT0FHQUgsT0FLQUEsUUFBQSxpQkFBQSxnQkFBQSxTQUFBSSxFQUFBQyxHQUNBQSxFQUFBQyxhQUFBQyxLQUFBLG1CQUNBSCxFQUNBSSxLQUFBLEtBQ0FDLFlBQUEsVUFFQUQsS0FBQSxXQUNBQyxZQUFBLFlBRUFELEtBQUEsV0FDQUMsWUFBQSxZQUVBRCxLQUFBLGFBQ0FDLFlBQUEsY0FFQUQsS0FBQSxxQkFDQUMsWUFBQSxzQkFFQUQsS0FBQSxVQUNBQyxZQUFBLFdBRUFELEtBQUEsaUJBQ0FDLFlBQUEsa0JBRUFDLFVBQUEsUUN0Q0FmLFFBQUFDLE9BQUEsT0FDQWUsV0FBQSxZQUFBLEtBQUEsU0FBQSxVQUFBLFlBQUEsU0FBQSxhQUFBLGNBQUEsU0FBQUMsRUFBQUMsRUFBQWYsRUFBQWdCLEVBQUFDLEVBQUFDLEVBQUFDLEdBR0FKLEVBQUFLLE1BQUEsNkVBRUFMLEVBQUFNLGFBQUEsRUFDQU4sRUFBQU8sYUFBQSxHQUVBSixFQUFBSyxX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Q0FBLEVBQUE5RixLQUFBVixRQUNBMkgsRUFBQW5CLEVBQUE5RixLQUFBYSxRQUVBcUcsRUFBQXBCLEVBQUE5RixLQUFBdUYsV0FRQSxRQUNBRSxXQUFBQSxFQUNBNEIsUUFBQUEsRUFDQW5GLFVBQUFBLE1DOUJBOUUsUUFBQUMsT0FBQSxPQUNBNkksUUFBQSxlQUFBLEtBQUEsUUFBQSxTQUFBN0gsRUFBQThILEdBRUEsR0FBQWxCLEdBQUEsU0FBQWpGLEdBQ0EsTUFBQTNCLEdBQUEsU0FBQTRJLEVBQUFDLEdBQ0FmLEVBQUFnQixLQUFBLGlCQUFBbkgsR0FBQVosS0FBQSxTQUFBMEcsR0FDQUEsRUFBQTlGLEtBQUFWLFNBQ0FMLFFBQUFDLElBQUEsa0JBQ0ErSCxFQUFBbkIsRUFBQTlGLEtBQUE0RSxRQUVBc0MsRUFBQXBCLEVBQUE5RixLQUFBdUYsV0FNQSxRQUNBTixTQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMjIuMDkuMjAxNi5cclxuICovXHJcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ3VpLnJvdXRlcicsICduZ0Nvb2tpZXMnXSk7XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTAuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSAkd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvbWFpbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zaWdudXAnLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWdudXAnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc2lnbmluJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWduaW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvdXNlcmluZm8nLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy91c2VyaW5mbydcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zdWNjZXNzZnVsU2lnbnVwJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zdWNjZXNzZnVsU2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL29mZmVyJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9vZmZlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jb25maXJtYXRpb24nLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2NvbmZpcm1hdGlvbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLm90aGVyd2lzZSgnLycpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdhdXRoQ3RybCcsIGZ1bmN0aW9uICgkcSwgJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sICRyb3V0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS5yZWdleCA9ICcoXFxcXCtbMC05XVxcXFxkezF9KSooXFxcXHMpKihbMC05XVxcXFxkezJ9KShcXFxccyopKFswLTldXFxcXGR7Mn0pKFxcXFxzKikoWzAtOV1cXFxcZHsyfSknO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuaXNMb2dnZWRJbiA9IGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaWduaW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dpbicpO1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5zaWduaW4oJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKG1zZywgc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pc0xvZ2VkSW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8kd2luZG93LmxvY2F0aW9uLmhyZWY9JyMvJztcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaWdub3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5zaWdub3V0KCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gZmFsc2U7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dvdXQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0VXNlckluZm8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldFVzZXJJbmZvKCkudGhlbihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJpbmZvID0gbXNnO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdWJtaXRGb3JtID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYoaXNWYWxpZCl7XHJcbiAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zaWdudXAoJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9tecWbbG5pZSB6YXJlamVzdHJvd2FubycpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ25pbigkc2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAobXNnLCBzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpID09ICdodHRwOi8vbG9jYWxob3N0OjMwMDEvIy9jb25maXJtYXRpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL3N1Y2Nlc3NmdWxTaWdudXAnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGRhdGEuY29kZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTEwMDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdXeWJyYW55IGVtYWlsIGplc3QganXFvCB6YXJlamVzdHJvd2FueS4gUHJvc3rEmSB3eWJyYcSHIGlubnkuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnVXBzcyBjb8WbIHBvc3rFgm8gbmllIHRhay4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBww7PFum5pZWouJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ1Vwc3MgY2/FmyBwb3N6xYJvIG5pZSB0YWsuIFByb3N6xJkgc3Byw7Nib3dhxIcgcMOzxbpuaWVqLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdzdWJtaXRFcnJvcicsIGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3JNZXNzYWdlKVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2NvbmZpcm1hdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHEsICR3aW5kb3csICRsb2NhdGlvbiwgJGNvb2tpZXMsICRzY29wZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmlzU2lnbmVkSW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJvb20gPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgncm9vbScpKTtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZGF0ZXMnKSkuZGF0ZUZyb207XHJcbiAgICAgICAgJHNjb3BlLmRhdGVUbyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKS5kYXRlVG87XHJcbiAgICAgICAgJHNjb3BlLmV4dHJhcyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdleHRyYXMnKSkuZXh0cmFzO1xyXG4gICAgICAgICRzY29wZS5udW1PZkRheXMgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZXh0cmFzJykpLm51bU9mRGF5cztcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCA/ICRzY29wZS5pc1NpZ25lZEluID0gdHJ1ZSA6ICRzY29wZS5pc1NpZ25lZEluID0gZmFsc2U7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vVE9ETyB6cm9iaWVuaWUgcmVqZXN0cmFjamkobW/FvGUgcHJ6ZW5pZXNpZW5pZSBuYSBzaWdudXAgdmlldz8gZG8gcm96d2HFvGVuaWEpIGkgb2JzxYJ1Z2EgYsWCxJlkw7N3KG1vxbxlIGpha2/FmyBwb8WCxIVjennEhyBvYnlkd2EgbG9nb3dhbmlhIGkgcmVqZXN0cmFjamUgdyBqZWRubz8pXHJcbiAgICAgICAgLy9UT0RPIHBvcm9iaWVuaWUgaSBwcnpldGVzdG93YW5pZSByZWZlcmVuY2ppIHcgbW9uZ29kYiBpIHpyb2JpZW5pZSBub3dlaiBrb2xla2NqaSBpIHBvdHdpZXJkem9ueW1pIHJlemVyd2FjamFtaSh6YXN0YW5vd2nEhyBzacSZIG5hZCBiYXrEhSBkYW55Y2gpXHJcbiAgICAgICAgLy9UT0RPIHByemVqxZtjaWUgZG8gdWRhbmVqIHJlemVyd2FjamkgdHlsa28gamVzbGkgc2llIHphYWtjZXB0dWplIHJlZ3VsYW1pblxyXG4gICAgICAgIC8vVE9ETyBPYnNsdWdhIGJsZWRvdyByZXplcndhY2ppXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgY3plZ29zIGRvIHdpZG9rdSByZXplcndhamNpXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgY2HFgmVqIG9ic8WCdWdpIGtvbnRhKHptaWFuYSBoYXPFgmEsIG51bWVydSB0ZWxlZm9udVtkb2RhbmllIGx1YiB6bWlhbmFdLCBwb2RnbMSFZHUgcmV6ZXJ3YWNqaSwgaXRwKSBvcmF6IG9ic8WCdWdpIGhvdGVsdShDUlVEIGRvZGF0a8OzdywgcG9rb2ppIGl0cCkuXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgbW/FvGUgamFracWbIHd5a3Jlc8OzdyBuYSB0ZW1hdCBvYmNpxIXFvGVuaWEgcG9rb2ppIGx1YiBqYWtpxZsgcHJ6eWNob2TDs3cgY3p5IGNvxZsgYWxibyBqYWllxZsgY2/FmyBkbyBnZW5lcm93YW5pZSBwZGYgeiByYXBvcnRlbVxyXG5cclxuICAgICAgICBpbml0KCk7XHJcblxyXG4gICAgfSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuZGlyZWN0aXZlKCdjb21wYXJlVG8nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWlyZTogXCJuZ01vZGVsXCIsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBvdGhlck1vZGVsVmFsdWU6IFwiPWNvbXBhcmVUb1wiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dGVzLCBuZ01vZGVsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5jb21wYXJlVG8gPSBmdW5jdGlvbihtb2RlbFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsVmFsdWUgPT0gc2NvcGUub3RoZXJNb2RlbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJvdGhlck1vZGVsVmFsdWVcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDguMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ29mZmVyQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRjb29raWVzLCAkbG9jYXRpb24sICR3aW5kb3csIG9mZmVyU3ZjKSB7XHJcbiAgICAgICAgJHNjb3BlLm9mZmVyID0ge307XHJcbiAgICAgICAgJHNjb3BlLmV4dHJhcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcyA9IFtdO1xyXG4gICAgICAgIHZhciBkYXRlcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5kYXRlRnJvbSA9ICcnO1xyXG4gICAgICAgICRzY29wZS5kYXRlVG8gPSAnJztcclxuICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAnJztcclxuXHJcblxyXG4gICAgICAgIHZhciBzaG93T2ZmZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5vZmZlciA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdyb29tJykpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZ2V0RXh0cmFzKCk7XHJcblxyXG4gICAgICAgICAgICBkYXRlcyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZVByZWV0aWZ5KG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlVG8gPSBkYXRlUHJlZXRpZnkobmV3IERhdGUoZGF0ZXMuZGF0ZVRvKSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAkc2NvcGUub2ZmZXIudHlwZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21QcmljZSA9ICRzY29wZS5vZmZlci5wcmljZTtcclxuICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgPSAwO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGF0ZVByZWV0aWZ5ID0gZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGRheSA9IGRhdGUuZ2V0VVRDRGF0ZSgpO1xyXG4gICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxO1xyXG4gICAgICAgICAgICB2YXIgeWVhciA9IGRhdGUuZ2V0VVRDRnVsbFllYXIoKTtcclxuICAgICAgICAgICAgcmV0dXJuICcnK2RheSsnLScrbW9udGgrJy0nK3llYXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZE9yUmVtb3ZlRXh0cmEgPSBmdW5jdGlvbiAoZXh0cmEpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9ICRzY29wZS5zZWxlY3RlZEV4dHJhcy5pbmRleE9mKGV4dHJhKTtcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVGV4dCA9IGV4dHJhLmJ1dHRvblRvZ2dsZSA/ICdEb2RhaiArJyA6ICdVc3XFhCAtJztcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVG9nZ2xlID0gIWV4dHJhLmJ1dHRvblRvZ2dsZTtcclxuXHJcbiAgICAgICAgICAgIGlmKGluZGV4ID09IC0xKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcy5wdXNoKGV4dHJhKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlICs9IChleHRyYS5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMuc3BsaWNlKGluZGV4LDEpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgLT0gKGV4dHJhLnByaWNlICogY2FsY3VsYXRlRGlmZk9mRGF5cygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS50b0NvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FzZGFzZCcpO1xyXG4gICAgICAgICAgICB2YXIgZXh0cmFzID0ge2V4dHJhczogJHNjb3BlLnNlbGVjdGVkRXh0cmFzLCBudW1PZkRheXM6IGNhbGN1bGF0ZURpZmZPZkRheXMoKX07XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZXh0cmFzJywgSlNPTi5zdHJpbmdpZnkoZXh0cmFzKSk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjL2NvbmZpcm1hdGlvbidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG9QcmV2aW91cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvbWFpbidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0cmFzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5nZXRFeHRyYXMoKS50aGVuKGZ1bmN0aW9uIChleHRyYXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZXh0cmFzRGF0YTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgJHNjb3BlLmV4dHJhcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1tpXS5idXR0b25UZXh0ID0gJ0RvZGFqICsnO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNbaV0uYnV0dG9uVG9nZ2xlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjYWxjdWxhdGVEaWZmT2ZEYXlzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgTVNfUEVSX0RBWSA9IDEwMDAgKiA2MCAqIDYwICogMjQ7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUbyA9IG5ldyBEYXRlKGRhdGVzLmRhdGVUbyk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbVVUQyA9IERhdGUuVVRDKGRhdGVGcm9tLmdldEZ1bGxZZWFyKCksIGRhdGVGcm9tLmdldE1vbnRoKCksIGRhdGVGcm9tLmdldERhdGUoKSk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlVG9VVEMgPSBEYXRlLlVUQyhkYXRlVG8uZ2V0RnVsbFllYXIoKSwgZGF0ZVRvLmdldE1vbnRoKCksIGRhdGVUby5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZVRvVVRDIC0gZGF0ZUZyb21VVEMpIC8gTVNfUEVSX0RBWSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2hvd09mZmVyKCk7XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDYuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3Jvb21DdHJsJywgZnVuY3Rpb24gKCRxLCAkY29va2llcywgJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIHJvb21TZXJ2aWNlLCBvZmZlclN2YywkZmlsdGVyKSB7XHJcbiAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLmRhdGVUbyA9ICcnO1xyXG4gICAgICAgICRzY29wZS5ub1Jvb21zRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuZXJyb3JNc2cgPScnO1xyXG4gICAgICAgICRzY29wZS5yb29tcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5udW1iZXJPZkJlZHMgPSAxO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHNldERhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0ZSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlRnJvbSA9IGRhdGU7XHJcbiAgICAgICAgICAgIHZhciBkYXRlVGVtcCA9IG5ldyBEYXRlO1xyXG4gICAgICAgICAgICBkYXRlVGVtcC5zZXREYXRlKGRhdGVUZW1wLmdldERhdGUoKSsxKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVUbyA9IGRhdGVUZW1wO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXREYXRlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5maW5kUm9vbXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZmluZFJvb21zID0gZnVuY3Rpb24gKCkgey8vVE9ETyBXecWbd2lldGxlbmllIGVycm9yYSBvIGJyYWt1IHBva29qaSBvIHd5YnJhbnljaCBwYXJhbWV0cmFjaCB1xbx5d2FqxIVjIG5vUm9vbXNFcnJvciBpIG5nLUhpZGVcclxuICAgICAgICAgICAgcm9vbVNlcnZpY2UuZ2V0Um9vbXMoe1xyXG4gICAgICAgICAgICAgICAgZnJvbTogJHNjb3BlLmRhdGVGcm9tLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICB0bzogJHNjb3BlLmRhdGVUby50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgYmVkczogJHNjb3BlLm51bWJlck9mQmVkc1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyb29tc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yb29tcyA9IHJvb21zRGF0YTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubm9Sb29tc0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1zZyA9ICdDb8WbIHBvc3rFgm8gbmllIHRhay4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5hZGRSb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuICAgICAgICAgICAgJGNvb2tpZXMucHV0KCdyb29tJywgSlNPTi5zdHJpbmdpZnkocm9vbSkpO1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ2RhdGVzJywgSlNPTi5zdHJpbmdpZnkoe2RhdGVGcm9tOiAkc2NvcGUuZGF0ZUZyb20sIGRhdGVUbzogJHNjb3BlLmRhdGVUb30pKTtcclxuICAgICAgICAgICAgb2ZmZXJTdmMuY2hvb3NlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL29mZmVyJztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJvb21zKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDcuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZpbHRlcigndW5pcXVlQ2F0ZWdvcmllcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJvb21zLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0FycmF5KHJvb21zKSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHJvb21zLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gcm9vbXNbaV1bcHJvcGVydHlOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQoa2V5c1t2YWxdKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXNbdmFsXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJvb21zW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvb21zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHEnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XHJcbiAgICAgICAgdmFyIExPQ0FMX1RPS0VOID0gJ3Rva2VuJztcclxuICAgICAgICB2YXIgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGF1dGhUb2tlbjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZFVzZXJJbmZvKCkge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oTE9DQUxfVE9LRU4pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9hZGluZyBVc2VyIGluZm8uLi4nKTsvL0RvIHVzdW5pxJljaWFcclxuICAgICAgICAgICAgaWYodG9rZW4pXHJcbiAgICAgICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZXN0cm95VXNlckluZm8oKSB7XHJcbiAgICAgICAgICAgIGF1dGhUb2tlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMT0NBTF9UT0tFTik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdG9yZVVzZXJJbmZvKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShMT0NBTF9UT0tFTiwgdG9rZW4pO1xyXG4gICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1c2VySW5mbyh0b2tlbikge1xyXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBhdXRoVG9rZW4gPSB0b2tlbjtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IGF1dGhUb2tlbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzaWduaW4gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9hdXRoZW50aWNhdGUnLCB1c2VyKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmVVc2VySW5mbyhyZXN1bHQuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICB2YXIgc2lnbm91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVzdHJveVVzZXJJbmZvKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNpZ251cCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3NpZ251cCcsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnamVzdGVtIHcgcmVzb2x2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsb2FkVXNlckluZm8oKTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3VzZXJpbmZvJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgc2lnbmluOiBzaWduaW4sXHJcbiAgICAgICAgICAgIHNpZ25vdXQ6IHNpZ25vdXQsXHJcbiAgICAgICAgICAgIHNpZ251cDogc2lnbnVwLFxyXG4gICAgICAgICAgICBnZXRVc2VySW5mbzogZ2V0VXNlckluZm8sXHJcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogaXNBdXRoZW50aWNhdGVkXHJcbiAgICAgICAgfVxyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwOC4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnb2ZmZXJTdmMnLCBmdW5jdGlvbiAoJHEsICRodHRwKSB7XHJcbiAgICAgICAgdmFyIGNob3NlblJvb20gPSB7fTtcclxuICAgICAgICB2YXIgZXh0cmFzID0gW107XHJcblxyXG4gICAgICAgIHZhciBjaG9vc2VSb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuICAgICAgICAgICAgY2hvb3NlblJvb20gPSByb29tO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRSb29tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hvb3NlblJvb207XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dHJhcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9nZXRFeHRyYXMnKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5leHRyYXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgY2hvb3NlUm9vbTogY2hvb3NlUm9vbSxcclxuICAgICAgICAgICAgZ2V0Um9vbTogZ2V0Um9vbSxcclxuICAgICAgICAgICAgZ2V0RXh0cmFzOiBnZXRFeHRyYXMsXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwNi4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgncm9vbVNlcnZpY2UnLCBmdW5jdGlvbiAoJHEsICRodHRwKSB7XHJcblxyXG4gICAgICAgIHZhciBnZXRSb29tcyA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2ZpbmRSb29tcycsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9icmFubyBwb2tvamUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5yb29tcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgZ2V0Um9vbXM6IGdldFJvb21zXHJcbiAgICAgICAgfVxyXG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
