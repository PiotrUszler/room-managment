var app=angular.module("app",["ngRoute","ui.router","ngCookies"]);angular.module("app").factory("authInterceptor",["$window",function(o){return{request:function(e){return e.headers=e.headers||{},o.localStorage.token&&(e.headers.Authorization=o.localStorage.token),e}}}]).config(["$stateProvider","$urlRouterProvider",function(o,e){o.state("home",{url:"/main",controller:"roomCtrl",templateUrl:"main"}).state("offer",{url:"/offer",controller:"offerCtrl",templateUrl:"offer"}).state("confirmation",{url:"/confirmation",templateUrl:"confirmation"}).state("successfulBooking",{url:"/successfulBooking",templateUrl:"successfulBooking"}).state("successfulSignup",{url:"/successfulSignup",templateUrl:"successfulSignup"}).state("userinfo",{url:"/userinfo",templateUrl:"userinfo"}).state("signin",{url:"/signin",templateUrl:"signin"}).state("signup",{url:"/signup",templateUrl:"signup"}),e.otherwise("/main")}]).run(["$rootScope","$state","$stateParams",function(o,e,t){o.$state=e,o.$stateParams=t}]),angular.module("app").controller("accCtrl",["$scope","AuthService",function(o,e){o.getUserBookings=function(){e.getUserBookings.then(function(e){console.log(e),o.userBookings=e})}}]),angular.module("app").controller("authCtrl",["$q","$scope","$window","$location","$route","$rootScope","AuthService",function(o,e,t,n,r,a,s){e.regex="(\\+[0-9]\\d{1})*(\\s)*([0-9]\\d{2})(\\s*)([0-9]\\d{2})(\\s*)([0-9]\\d{2})",e.submitError=!1,e.errorMessage="",a.isLoggedIn=function(){return s.isAuthenticated},e.signin=function(){console.log("login"),s.signin(e.user).then(function(o,e){a.isLogedIn=!0,t.location.reload(),console.log(o)})},e.signout=function(){s.signout(),a.isLogedIn=!1,t.location.reload(),console.log("logout")},e.getUserInfo=function(){s.getUserInfo().then(function(o){console.log(o),e.userinfo=o})},e.submitForm=function(o){o?s.signup(e.user).then(function(o){console.log("Pomyślnie zarejestrowano"),e.submitError=!1,s.signin(e.user).then(function(o,e){a.isLogedIn=!0,"http://localhost:3001/#/confirmation"==t.location.toString()?t.location.reload():t.location.href="#/successfulSignup"})},function(o){switch(console.log(o),o.code){case 11e3:e.submitError=!0,e.errorMessage="Wybrany email jest już zarejestrowany. Proszę wybrać inny.";break;default:e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później."}}):(e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później.")},e.$watch("submitError",function(o){console.log(o)})}]),angular.module("app").controller("confirmationCtrl",["$q","$window","$location","$cookies","$scope","$rootScope","AuthService","roomService",function(o,e,t,n,r,a,s,i){r.isSignedIn=!1,r.room=JSON.parse(n.get("room")),r.dateFrom=JSON.parse(n.get("dates")).dateFrom,r.dateTo=JSON.parse(n.get("dates")).dateTo,r.extras=JSON.parse(n.get("extras")).extras,r.numOfDays=JSON.parse(n.get("extras")).numOfDays;var u=function(){s.isAuthenticated?r.isSignedIn=!0:r.isSignedIn=!1};r.reserve=function(){1!=r.terms?alert("Przed potwierdzeniem rezerwacji należy zaakceptowaćregulamin."):i.bookRoom({id:r.room._id,from:r.dateFrom,to:r.dateTo,price:c(),extras:r.extras}).then(function(){e.location.href="#/successfulBooking"},function(o){})},r.toPrevious=function(){e.location.href="#/offer"};var c=function(){var o=0;return o=r.room.price*r.numOfDays,r.extras.forEach(function(e){o+=e.price*r.numOfDays}),o};u()}]),angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(o,e,t,n){n.$validators.compareTo=function(e){return e==o.otherModelValue},o.$watch("otherModelValue",function(){n.$validate()})}}}).directive("userInfo",function(){return{template:"<p>sialala</p>"}}),angular.module("app").controller("offerCtrl",["$scope","$cookies","$location","$window","offerSvc",function(o,e,t,n,r){o.offer={},o.extras=[],o.selectedExtras=[];var a={};o.dateFrom="",o.dateTo="",o.roomName="";var s=function(){o.offer=JSON.parse(e.get("room")),o.extras=u(),a=JSON.parse(e.get("dates")),o.dateFrom=i(new Date(a.dateFrom)),o.dateTo=i(new Date(a.dateTo)),o.roomName=o.offer.type,o.roomPrice=o.offer.price*c(),o.extrasTotalPrice=0},i=function(o){var e=o.getUTCDate(),t=o.getUTCMonth()+1,n=o.getUTCFullYear();return""+e+"-"+t+"-"+n};o.addOrRemoveExtra=function(e){var t=o.selectedExtras.indexOf(e);e.buttonText=e.buttonToggle?"Dodaj +":"Usuń -",e.buttonToggle=!e.buttonToggle,t==-1?(o.selectedExtras.push(e),o.extrasTotalPrice+=e.price*c()):(o.selectedExtras.splice(t,1),o.extrasTotalPrice-=e.price*c())},o.toConfirmation=function(){console.log("asdasd");var t={extras:o.selectedExtras,numOfDays:c()};e.put("extras",JSON.stringify(t)),n.location.href="#/confirmation"},o.toPrevious=function(){n.location.href="#/main"};var u=function(){r.getExtras().then(function(e){o.extras=e;for(var t=0;t<o.extras.length;t++)o.extras[t].buttonText="Dodaj +",o.extras[t].buttonToggle=!1})},c=function(){var o=864e5,e=new Date(a.dateFrom),t=new Date(a.dateTo),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((r-n)/o)};s()}]),angular.module("app").controller("roomCtrl",["$q","$cookies","$scope","$window","$location","roomService","offerSvc","$filter","$state",function(o,e,t,n,r,a,s,i,u){t.dateFrom="",t.dateTo="",t.noRoomsError=!1,t.errorMsg="",t.rooms=[],t.numberOfBeds=1;var c=function(){var o=new Date;console.log(o),t.dateFrom=o;var e=new Date;e.setDate(e.getDate()+1),t.dateTo=e};t.init=function(){c(),t.findRooms()},t.findRooms=function(){a.getRooms({from:t.dateFrom.toISOString(),to:t.dateTo.toISOString(),beds:t.numberOfBeds}).then(function(o){t.rooms=o},function(o){t.noRoomsError=!0,t.errorMsg="Coś poszło nie tak."})},t.addRoom=function(o){e.put("room",JSON.stringify(o)),e.put("dates",JSON.stringify({dateFrom:t.dateFrom,dateTo:t.dateTo})),s.chooseRoom(o),u.go("offer")},t.test=function(){console.log(t.rooms),t.findRooms()}}]),angular.module("app").filter("uniqueCategories",function(){return function(o,e){if(angular.isArray(o)){for(var t=[],n={},r=0;r<o.length;r++){var a=o[r][e];angular.isUndefined(n[a])&&(n[a]=!0,t.push(o[r]))}return t}return o}}),angular.module("app").service("AuthService",["$http","$q",function(o,e){function t(){var o=window.localStorage.getItem(i);console.log("loading User info..."),o&&a(o)}function n(){s=void 0,u=!1,o.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(i)}function r(o){window.localStorage.setItem(i,o),a(o)}function a(e){u=!0,s=e,o.defaults.headers.common.Authorization=s}var s,i="token",u=!1,c=function(t){return e(function(e,n){o.post("/api/authenticate",t).then(function(o){o.data.success?(r(o.data.token),e(o.data.msg,o.data.success)):n(o.data.msg,o.data.success)})})},l=function(){n()},f=function(t){return e(function(e,n){o.post("/api/signup",t).then(function(o){o.data.success?(console.log("jestem w resolve"),e(o.data.msg)):n(o.data.msg)})})};t();var g=function(){return e(function(e,t){o.get("/api/userinfo").then(function(o){o.data.success?e(o.data.msg):t(o.data.msg)})})},d=function(){return e(function(e,t){o.get("/api/getUserBookings").then(function(o){e(o.data)})})};return{signin:c,signout:l,signup:f,getUserInfo:g,getUserBookings:d(),isAuthenticated:u}}]),angular.module("app").service("offerSvc",["$q","$http",function(o,e){var t=function(o){choosenRoom=o},n=function(){return choosenRoom},r=function(){return o(function(o,t){e.get("/api/getExtras").then(function(e){e.data.success?o(e.data.extras):t(e.data.error)})})};return{chooseRoom:t,getRoom:n,getExtras:r}}]),angular.module("app").service("roomService",["$q","$http",function(o,e){var t=function(t){return o(function(o,n){e.post("/api/findRooms",t).then(function(e){e.data.success?(console.log("Pobrano pokoje"),o(e.data.rooms)):n(e.data.error)})})},n=function(t){return o(function(o,n){e.post("/api/reserve",t).then(function(e){e.data.success?o(e.data.success):n(e.data.error)})})};return{getRooms:t,bookRoom:n}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbmZpZy5qcyIsImNvbnRyb2xsZXJzL2FjY291bnRDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aG9yaXphdGlvbi5qcyIsImNvbnRyb2xsZXJzL2NvbmZpcm1hdGlvbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9kaXJlY3RpdmVzLmpzIiwiY29udHJvbGxlcnMvb2ZmZXJDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcm9vbUNvbnRyb2xsZXIuanMiLCJmaWxsdGVycy9yb29tRmlsdGVyLmpzIiwic2VydmljZXMvYXV0aG9yaXphdGlvbi5zdmMuanMiLCJzZXJ2aWNlcy9vZmZlci5zdmMuanMiLCJzZXJ2aWNlcy9yb29tLnN2Yy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiZmFjdG9yeSIsIiR3aW5kb3ciLCJyZXF1ZXN0IiwiY29uZmlnIiwiaGVhZGVycyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsImNvbnRyb2xsZXIiLCJ0ZW1wbGF0ZVVybCIsIm90aGVyd2lzZSIsInJ1biIsIiRyb290U2NvcGUiLCIkc3RhdGUiLCIkc3RhdGVQYXJhbXMiLCIkc2NvcGUiLCJBdXRoU2VydmljZSIsImdldFVzZXJCb29raW5ncyIsInRoZW4iLCJtc2ciLCJjb25zb2xlIiwibG9nIiwidXNlckJvb2tpbmdzIiwiJHEiLCIkbG9jYXRpb24iLCIkcm91dGUiLCJyZWdleCIsInN1Ym1pdEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaXNMb2dnZWRJbiIsImlzQXV0aGVudGljYXRlZCIsInNpZ25pbiIsInVzZXIiLCJzdWNjZXNzIiwiaXNMb2dlZEluIiwibG9jYXRpb24iLCJyZWxvYWQiLCJzaWdub3V0IiwiZ2V0VXNlckluZm8iLCJ1c2VyaW5mbyIsInN1Ym1pdEZvcm0iLCJpc1ZhbGlkIiwic2lnbnVwIiwiZGF0YSIsInRvU3RyaW5nIiwiaHJlZiIsImNvZGUiLCIkd2F0Y2giLCIkY29va2llcyIsInJvb21TZXJ2aWNlIiwiaXNTaWduZWRJbiIsInJvb20iLCJKU09OIiwicGFyc2UiLCJnZXQiLCJkYXRlRnJvbSIsImRhdGVUbyIsImV4dHJhcyIsIm51bU9mRGF5cyIsImluaXQiLCJyZXNlcnZlIiwidGVybXMiLCJhbGVydCIsImJvb2tSb29tIiwiaWQiLCJfaWQiLCJmcm9tIiwidG8iLCJwcmljZSIsImNhbGN1bGF0ZVRvdGFsUHJpY2UiLCJlcnJvciIsInRvUHJldmlvdXMiLCJ0b3RhbCIsImZvckVhY2giLCJlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJNb2RlbFZhbHVlIiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dGVzIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiY29tcGFyZVRvIiwibW9kZWxWYWx1ZSIsIiR2YWxpZGF0ZSIsInRlbXBsYXRlIiwib2ZmZXJTdmMiLCJvZmZlciIsInNlbGVjdGVkRXh0cmFzIiwiZGF0ZXMiLCJyb29tTmFtZSIsInNob3dPZmZlciIsImdldEV4dHJhcyIsImRhdGVQcmVldGlmeSIsIkRhdGUiLCJ0eXBlIiwicm9vbVByaWNlIiwiY2FsY3VsYXRlRGlmZk9mRGF5cyIsImV4dHJhc1RvdGFsUHJpY2UiLCJkYXRlIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsIm1vbnRoIiwiZ2V0VVRDTW9udGgiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJhZGRPclJlbW92ZUV4dHJhIiwiZXh0cmEiLCJpbmRleCIsImluZGV4T2YiLCJidXR0b25UZXh0IiwiYnV0dG9uVG9nZ2xlIiwicHVzaCIsInNwbGljZSIsInRvQ29uZmlybWF0aW9uIiwicHV0Iiwic3RyaW5naWZ5IiwiZXh0cmFzRGF0YSIsImkiLCJsZW5ndGgiLCJNU19QRVJfREFZIiwiZGF0ZUZyb21VVEMiLCJVVEMiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImRhdGVUb1VUQyIsIk1hdGgiLCJmbG9vciIsIiRmaWx0ZXIiLCJub1Jvb21zRXJyb3IiLCJlcnJvck1zZyIsInJvb21zIiwibnVtYmVyT2ZCZWRzIiwic2V0RGF0ZSIsImRhdGVUZW1wIiwiZmluZFJvb21zIiwiZ2V0Um9vbXMiLCJ0b0lTT1N0cmluZyIsImJlZHMiLCJyb29tc0RhdGEiLCJhZGRSb29tIiwiY2hvb3NlUm9vbSIsImdvIiwidGVzdCIsImZpbHRlciIsInByb3BlcnR5TmFtZSIsImlzQXJyYXkiLCJyZXN1bHQiLCJrZXlzIiwidmFsIiwiaXNVbmRlZmluZWQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJsb2FkVXNlckluZm8iLCJ3aW5kb3ciLCJnZXRJdGVtIiwiTE9DQUxfVE9LRU4iLCJ1c2VySW5mbyIsImRlc3Ryb3lVc2VySW5mbyIsImF1dGhUb2tlbiIsInVuZGVmaW5lZCIsImRlZmF1bHRzIiwiY29tbW9uIiwicmVtb3ZlSXRlbSIsInN0b3JlVXNlckluZm8iLCJzZXRJdGVtIiwicmVzb2x2ZSIsInJlamVjdCIsInBvc3QiLCJjaG9vc2VuUm9vbSIsImdldFJvb20iXSwibWFwcGluZ3MiOiJBQUdBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsT0FBQSxVQUFBLFlBQUEsYUNBQUQsU0FBQUMsT0FBQSxPQUNBQyxRQUFBLG1CQUFBLFVBQUEsU0FBQUMsR0FDQSxPQUNBQyxRQUFBLFNBQUFDLEdBTUEsTUFMQUEsR0FBQUMsUUFBQUQsRUFBQUMsWUFDQUgsRUFBQUksYUFBQUMsUUFDQUgsRUFBQUMsUUFBQSxjQUFBSCxFQUFBSSxhQUFBQyxPQUdBSCxPQUtBQSxRQUFBLGlCQUFBLHFCQUFBLFNBQUFJLEVBQUFDLEdBQ0FELEVBQ0FFLE1BQUEsUUFDQUMsSUFBQSxRQUNBQyxXQUFBLFdBQ0FDLFlBQUEsU0FFQUgsTUFBQSxTQUNBQyxJQUFBLFNBQ0FDLFdBQUEsWUFDQUMsWUFBQSxVQUVBSCxNQUFBLGdCQUNBQyxJQUFBLGdCQUNBRSxZQUFBLGlCQUVBSCxNQUFBLHFCQUNBQyxJQUFBLHFCQUNBRSxZQUFBLHNCQUVBSCxN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QUFBLEVBQ0FLLE9BQUFBLEVBQ0FKLFlBQUFBLEVBQ0FyQixnQkFBQUEsSUFDQWEsZ0JBQUFBLE1DM0ZBbkMsUUFBQUMsT0FBQSxPQUNBOEosUUFBQSxZQUFBLEtBQUEsUUFBQSxTQUFBbkksRUFBQW9JLEdBQ0EsR0FHQVgsR0FBQSxTQUFBN0YsR0FDQXlILFlBQUF6SCxHQUdBMEgsRUFBQSxXQUNBLE1BQUFELGNBR0E5RSxFQUFBLFdBQ0EsTUFBQXZFLEdBQUEsU0FBQWtKLEVBQUFDLEdBQ0FmLEVBQUFyRyxJQUFBLGtCQUFBcEMsS0FBQSxTQUFBb0ksR0FDQUEsRUFBQTNHLEtBQUFWLFFBQ0F3SSxFQUFBbkIsRUFBQTNHLEtBQUFjLFFBRUFpSCxFQUFBcEIsRUFBQTNHLEtBQUEyQixXQVFBLFFBQ0EwRSxXQUFBQSxFQUNBNkIsUUFBQUEsRUFDQS9FLFVBQUFBLE1DOUJBbkcsUUFBQUMsT0FBQSxPQUNBOEosUUFBQSxlQUFBLEtBQUEsUUFBQSxTQUFBbkksRUFBQW9JLEdBRUEsR0FBQWhCLEdBQUEsU0FBQWhHLEdBQ0EsTUFBQXBCLEdBQUEsU0FBQWtKLEVBQUFDLEdBQ0FmLEVBQUFnQixLQUFBLGlCQUFBaEksR0FBQXpCLEtBQUEsU0FBQW9JLEdBQ0FBLEVBQUEzRyxLQUFBVixTQUNBYixRQUFBQyxJQUFBLGtCQUNBb0osRUFBQW5CLEVBQUEzRyxLQUFBMkYsUUFFQW9DLEVBQUFwQixFQUFBM0csS0FBQTJCLFlBTUFQLEVBQUEsU0FBQXBCLEdBQ0EsTUFBQXBCLEdBQUEsU0FBQWtKLEVBQUFDLEdBQ0FmLEVBQUFnQixLQUFBLGVBQUFoSSxHQUFBekIsS0FBQSxTQUFBb0ksR0FDQUEsRUFBQTNHLEtBQUFWLFFBQ0F3SSxFQUFBbkIsRUFBQTNHLEtBQUFWLFNBRUF5SSxFQUFBcEIsRUFBQTNHLEtBQUEyQixXQU1BLFFBQ0FxRSxTQUFBQSxFQUNBNUUsU0FBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDIyLjA5LjIwMTYuXHJcbiAqL1xyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsnbmdSb3V0ZScsICd1aS5yb3V0ZXInLCAnbmdDb29raWVzJ10pO1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDExLjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5mYWN0b3J5KCdhdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbiAoJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICdyZXF1ZXN0JzogZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL21haW4nLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3Jvb21DdHJsJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWFpbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdvZmZlcicse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL29mZmVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdvZmZlckN0cmwnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdvZmZlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb25maXJtYXRpb24nLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jb25maXJtYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb25maXJtYXRpb24nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc3VjY2Vzc2Z1bEJvb2tpbmcnLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zdWNjZXNzZnVsQm9va2luZycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3N1Y2Nlc3NmdWxCb29raW5nJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3N1Y2Nlc3NmdWxTaWdudXAnLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zdWNjZXNzZnVsU2lnbnVwJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3VjY2Vzc2Z1bFNpZ251cCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCd1c2VyaW5mbycse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3VzZXJpbmZvJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcmluZm8nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc2lnbmluJyx7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmluJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2lnbmluJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3NpZ251cCcse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3NpZ251cCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NpZ251cCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL21haW4nKVxyXG4gICAgfSlcclxuICAgIC5ydW4oWyckcm9vdFNjb3BlJywgJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLFxyXG4gICAgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS4kc3RhdGUgPSAkc3RhdGU7XHJcbiAgICAgICAgJHJvb3RTY29wZS4kc3RhdGVQYXJhbXMgPSAkc3RhdGVQYXJhbXM7XHJcbiAgICB9XSk7XHJcbiAgICAvKlxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdhdXRoSW50ZXJjZXB0b3InKTtcclxuICAgICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignLycsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL21haW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc2lnbnVwJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3NpZ25pbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc2lnbmluJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3VzZXJpbmZvJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdXNlcmluZm8nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc3VjY2Vzc2Z1bFNpZ251cCcse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc3VjY2Vzc2Z1bFNpZ251cCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9vZmZlcicse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvb2ZmZXInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY29uZmlybWF0aW9uJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9jb25maXJtYXRpb24nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc3VjY2Vzc2Z1bEJvb2tpbmcnLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3N1Y2Nlc3NmdWxCb29raW5nJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAub3RoZXJ3aXNlKCcvJyk7XHJcbiAgICB9KTtcclxuKi9cclxuXHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxNC4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignYWNjQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIEF1dGhTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgICRzY29wZS5nZXRVc2VyQm9va2luZ3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldFVzZXJCb29raW5ncy50aGVuKGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlckJvb2tpbmdzID0gbXNnO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfTtcclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxNC4xMC4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignYXV0aEN0cmwnLCBmdW5jdGlvbiAoJHEsICRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCAkcm91dGUsICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlKSB7XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUucmVnZXggPSAnKFxcXFwrWzAtOV1cXFxcZHsxfSkqKFxcXFxzKSooWzAtOV1cXFxcZHsyfSkoXFxcXHMqKShbMC05XVxcXFxkezJ9KShcXFxccyopKFswLTldXFxcXGR7Mn0pJztcclxuXHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbiAoKXtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2lnbmluID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9naW4nKTtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbmluKCRzY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChtc2csIHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjLyc7XHJcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobXNnKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2lnbm91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbm91dCgpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmlzTG9nZWRJbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9nb3V0Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldFVzZXJJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5nZXRVc2VySW5mbygpLnRoZW4oZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobXNnKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS51c2VyaW5mbyA9IG1zZztcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgICRzY29wZS5zdWJtaXRGb3JtID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYoaXNWYWxpZCl7XHJcbiAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zaWdudXAoJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9tecWbbG5pZSB6YXJlamVzdHJvd2FubycpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ25pbigkc2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAobXNnLCBzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpID09ICdodHRwOi8vbG9jYWxob3N0OjMwMDEvIy9jb25maXJtYXRpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL3N1Y2Nlc3NmdWxTaWdudXAnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGRhdGEuY29kZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTEwMDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdXeWJyYW55IGVtYWlsIGplc3QganXFvCB6YXJlamVzdHJvd2FueS4gUHJvc3rEmSB3eWJyYcSHIGlubnkuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnVXBzcyBjb8WbIHBvc3rFgm8gbmllIHRhay4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBww7PFum5pZWouJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ1Vwc3MgY2/FmyBwb3N6xYJvIG5pZSB0YWsuIFByb3N6xJkgc3Byw7Nib3dhxIcgcMOzxbpuaWVqLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdzdWJtaXRFcnJvcicsIGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3JNZXNzYWdlKVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2NvbmZpcm1hdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHEsICR3aW5kb3csICRsb2NhdGlvbiwgJGNvb2tpZXMsICRzY29wZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UsIHJvb21TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5pc1NpZ25lZEluID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS5yb29tID0gSlNPTi5wYXJzZSgkY29va2llcy5nZXQoJ3Jvb20nKSk7XHJcbiAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gSlNPTi5wYXJzZSgkY29va2llcy5nZXQoJ2RhdGVzJykpLmRhdGVGcm9tO1xyXG4gICAgICAgICRzY29wZS5kYXRlVG8gPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZGF0ZXMnKSkuZGF0ZVRvO1xyXG4gICAgICAgICRzY29wZS5leHRyYXMgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZXh0cmFzJykpLmV4dHJhcztcclxuICAgICAgICAkc2NvcGUubnVtT2ZEYXlzID0gSlNPTi5wYXJzZSgkY29va2llcy5nZXQoJ2V4dHJhcycpKS5udW1PZkRheXM7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQgPyAkc2NvcGUuaXNTaWduZWRJbiA9IHRydWUgOiAkc2NvcGUuaXNTaWduZWRJbiA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICRzY29wZS5yZXNlcnZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZigkc2NvcGUudGVybXMgIT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgIGFsZXJ0KCdQcnplZCBwb3R3aWVyZHplbmllbSByZXplcndhY2ppIG5hbGXFvHkgemFha2NlcHRvd2HEh3JlZ3VsYW1pbi4nKTtcclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIHJvb21TZXJ2aWNlLmJvb2tSb29tKHtpZDogJHNjb3BlLnJvb20uX2lkLCBmcm9tOiAkc2NvcGUuZGF0ZUZyb20sIHRvOiAkc2NvcGUuZGF0ZVRvLCBwcmljZTogY2FsY3VsYXRlVG90YWxQcmljZSgpLCBleHRyYXM6ICRzY29wZS5leHRyYXN9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIy9zdWNjZXNzZnVsQm9va2luZydcclxuICAgICAgICAgICAgICAgIH0sZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIHd5xZt3aWV0bGVuaWUgZXJycm9yYVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG9QcmV2aW91cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvb2ZmZXInXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNhbGN1bGF0ZVRvdGFsUHJpY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDA7XHJcbiAgICAgICAgICAgIHRvdGFsID0gKCRzY29wZS5yb29tLnByaWNlICogJHNjb3BlLm51bU9mRGF5cyk7XHJcbiAgICAgICAgICAgICRzY29wZS5leHRyYXMuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdG90YWwgKz0gZS5wcmljZSAqICRzY29wZS5udW1PZkRheXM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdG90YWw7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vVE9ETyB6cm9iaWVuaWUgcmVqZXN0cmFjamkobW/FvGUgcHJ6ZW5pZXNpZW5pZSBuYSBzaWdudXAgdmlldz8gZG8gcm96d2HFvGVuaWEpIGkgb2JzxYJ1Z2EgYsWCxJlkw7N3KG1vxbxlIGpha2/FmyBwb8WCxIVjennEhyBvYnlkd2EgbG9nb3dhbmlhIGkgcmVqZXN0cmFjamUgdyBqZWRubz8pXHJcbiAgICAgICAgLy9UT0RPIE9ic2x1Z2EgYmxlZG93IHJlemVyd2FjamlcclxuICAgICAgICAvL1RPRE8gZG9kYW5pZSBjemVnb3MgZG8gd2lkb2t1IHJlemVyd2FqY2lcclxuICAgICAgICAvL1RPRE8gZG9kYW5pZSBjYcWCZWogb2JzxYJ1Z2kga29udGEoem1pYW5hIGhhc8WCYSwgbnVtZXJ1IHRlbGVmb251W2RvZGFuaWUgbHViIHptaWFuYV0sIHBvZGdsxIVkdSByZXplcndhY2ppLCBpdHApIG9yYXogb2JzxYJ1Z2kgaG90ZWx1KENSVUQgZG9kYXRrw7N3LCBwb2tvamkgaXRwKS5cclxuICAgICAgICAvL1RPRE8gZG9kYW5pZSBtb8W8ZSBqYWtpxZsgd3lrcmVzw7N3IG5hIHRlbWF0IG9iY2nEhcW8ZW5pYSBwb2tvamkgbHViIGpha2nFmyBwcnp5Y2hvZMOzdyBjenkgY2/FmyBhbGJvIGphaWXFmyBjb8WbIGRvIGdlbmVyb3dhbmllIHBkZiB6IHJhcG9ydGVtXHJcbiAgICAgICAgLy9UT0RPIHBvem1pZW5pYcSHIHPFgm93YSByZXNlcnZhdGlvbiBpdHAgbmEgYm9va2luZ1xyXG4gICAgICAgIC8vVE9ETyBrb2R5IHJhYmF0b3dlXHJcbiAgICAgICAgLy9UT0RPIHBvd2lhZG9taWVuaWUgbyBjaWFzdGVjemthY2hcclxuICAgICAgICAvL1RPRE8gem1pYW5hIG5hIHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAvL1RPRE8gcG96bmFuaWUgc3RhdGVQcm92aWRlcmEgaSBkb2RhbmllIG5lc3RlZCB2aWV3cyBvcmF6IHVwb3J6xIV0a293YW5pZSByb3V0ZXJhKG5hend5KVxyXG4gICAgICAgIC8vVE9ETyBuYSBnxYLDs3duZWogc3Ryb25pZSB6cm9iacSHxbxlYnkgZGF0YSBiecWCxIUgY29uYWptbmllaiBqZWRlbiBkemllbiByZXplcndhY2ppXHJcbiAgICAgICAgLy9UT0RPIGtvbnRvXHJcbiAgICAgICAgLy96bWlhbmEgZGFueWNoXHJcbiAgICAgICAgLy96bWlhbmEgaGFzxYJhXHJcbiAgICAgICAgLy96b2JhY3plbmllIHJlemVyd2FjamlcclxuICAgICAgICAvL2FudWxvd2FuaWUgcmV6ZXJ3YWNqaVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaW5pdCgpO1xyXG5cclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmRpcmVjdGl2ZSgnY29tcGFyZVRvJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgb3RoZXJNb2RlbFZhbHVlOiBcIj1jb21wYXJlVG9cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgbmdNb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY29tcGFyZVRvID0gZnVuY3Rpb24obW9kZWxWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09IHNjb3BlLm90aGVyTW9kZWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwib3RoZXJNb2RlbFZhbHVlXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KVxyXG4gICAgLmRpcmVjdGl2ZSgndXNlckluZm8nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxwPnNpYWxhbGE8L3A+J1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDguMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ29mZmVyQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRjb29raWVzLCAkbG9jYXRpb24sICR3aW5kb3csIG9mZmVyU3ZjKSB7XHJcbiAgICAgICAgJHNjb3BlLm9mZmVyID0ge307XHJcbiAgICAgICAgJHNjb3BlLmV4dHJhcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcyA9IFtdO1xyXG4gICAgICAgIHZhciBkYXRlcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5kYXRlRnJvbSA9ICcnO1xyXG4gICAgICAgICRzY29wZS5kYXRlVG8gPSAnJztcclxuICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAnJztcclxuXHJcblxyXG4gICAgICAgIHZhciBzaG93T2ZmZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5vZmZlciA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdyb29tJykpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZ2V0RXh0cmFzKCk7XHJcblxyXG4gICAgICAgICAgICBkYXRlcyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZVByZWV0aWZ5KG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlVG8gPSBkYXRlUHJlZXRpZnkobmV3IERhdGUoZGF0ZXMuZGF0ZVRvKSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAkc2NvcGUub2ZmZXIudHlwZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21QcmljZSA9ICRzY29wZS5vZmZlci5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgPSAwO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGF0ZVByZWV0aWZ5ID0gZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGRheSA9IGRhdGUuZ2V0VVRDRGF0ZSgpO1xyXG4gICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxO1xyXG4gICAgICAgICAgICB2YXIgeWVhciA9IGRhdGUuZ2V0VVRDRnVsbFllYXIoKTtcclxuICAgICAgICAgICAgcmV0dXJuICcnK2RheSsnLScrbW9udGgrJy0nK3llYXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZE9yUmVtb3ZlRXh0cmEgPSBmdW5jdGlvbiAoZXh0cmEpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9ICRzY29wZS5zZWxlY3RlZEV4dHJhcy5pbmRleE9mKGV4dHJhKTtcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVGV4dCA9IGV4dHJhLmJ1dHRvblRvZ2dsZSA/ICdEb2RhaiArJyA6ICdVc3XFhCAtJztcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVG9nZ2xlID0gIWV4dHJhLmJ1dHRvblRvZ2dsZTtcclxuXHJcbiAgICAgICAgICAgIGlmKGluZGV4ID09IC0xKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcy5wdXNoKGV4dHJhKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlICs9IChleHRyYS5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMuc3BsaWNlKGluZGV4LDEpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgLT0gKGV4dHJhLnByaWNlICogY2FsY3VsYXRlRGlmZk9mRGF5cygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS50b0NvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FzZGFzZCcpO1xyXG4gICAgICAgICAgICB2YXIgZXh0cmFzID0ge2V4dHJhczogJHNjb3BlLnNlbGVjdGVkRXh0cmFzLCBudW1PZkRheXM6IGNhbGN1bGF0ZURpZmZPZkRheXMoKX07XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZXh0cmFzJywgSlNPTi5zdHJpbmdpZnkoZXh0cmFzKSk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjL2NvbmZpcm1hdGlvbidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG9QcmV2aW91cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvbWFpbidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0cmFzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5nZXRFeHRyYXMoKS50aGVuKGZ1bmN0aW9uIChleHRyYXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZXh0cmFzRGF0YTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgJHNjb3BlLmV4dHJhcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1tpXS5idXR0b25UZXh0ID0gJ0RvZGFqICsnO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNbaV0uYnV0dG9uVG9nZ2xlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjYWxjdWxhdGVEaWZmT2ZEYXlzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgTVNfUEVSX0RBWSA9IDEwMDAgKiA2MCAqIDYwICogMjQ7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUbyA9IG5ldyBEYXRlKGRhdGVzLmRhdGVUbyk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbVVUQyA9IERhdGUuVVRDKGRhdGVGcm9tLmdldEZ1bGxZZWFyKCksIGRhdGVGcm9tLmdldE1vbnRoKCksIGRhdGVGcm9tLmdldERhdGUoKSk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlVG9VVEMgPSBEYXRlLlVUQyhkYXRlVG8uZ2V0RnVsbFllYXIoKSwgZGF0ZVRvLmdldE1vbnRoKCksIGRhdGVUby5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZVRvVVRDIC0gZGF0ZUZyb21VVEMpIC8gTVNfUEVSX0RBWSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2hvd09mZmVyKCk7XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDYuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3Jvb21DdHJsJywgZnVuY3Rpb24gKCRxLCAkY29va2llcywgJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIHJvb21TZXJ2aWNlLCBvZmZlclN2YywkZmlsdGVyLCAkc3RhdGUpIHtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSAnJztcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLm5vUm9vbXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5lcnJvck1zZyA9Jyc7XHJcbiAgICAgICAgJHNjb3BlLnJvb21zID0gW107XHJcbiAgICAgICAgJHNjb3BlLm51bWJlck9mQmVkcyA9IDE7XHJcblxyXG5cclxuICAgICAgICB2YXIgc2V0RGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRlKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUZW1wID0gbmV3IERhdGU7XHJcbiAgICAgICAgICAgIGRhdGVUZW1wLnNldERhdGUoZGF0ZVRlbXAuZ2V0RGF0ZSgpKzEpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZVRvID0gZGF0ZVRlbXA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNldERhdGUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5maW5kUm9vbXMgPSBmdW5jdGlvbiAoKSB7Ly9UT0RPIFd5xZt3aWV0bGVuaWUgZXJyb3JhIG8gYnJha3UgcG9rb2ppIG8gd3licmFueWNoIHBhcmFtZXRyYWNoIHXFvHl3YWrEhWMgbm9Sb29tc0Vycm9yIGkgbmctSGlkZVxyXG4gICAgICAgICAgICByb29tU2VydmljZS5nZXRSb29tcyh7XHJcbiAgICAgICAgICAgICAgICBmcm9tOiAkc2NvcGUuZGF0ZUZyb20udG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHRvOiAkc2NvcGUuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICBiZWRzOiAkc2NvcGUubnVtYmVyT2ZCZWRzXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJvb21zRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJvb21zID0gcm9vbXNEYXRhO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5ub1Jvb21zRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTXNnID0gJ0NvxZsgcG9zesWCbyBuaWUgdGFrLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZFJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ3Jvb20nLCBKU09OLnN0cmluZ2lmeShyb29tKSk7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZGF0ZXMnLCBKU09OLnN0cmluZ2lmeSh7ZGF0ZUZyb206ICRzY29wZS5kYXRlRnJvbSwgZGF0ZVRvOiAkc2NvcGUuZGF0ZVRvfSkpO1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5jaG9vc2VSb29tKHJvb20pO1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ29mZmVyJyk7XHJcbiAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL29mZmVyJztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJvb21zKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDcuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZpbHRlcigndW5pcXVlQ2F0ZWdvcmllcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJvb21zLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0FycmF5KHJvb21zKSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHJvb21zLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gcm9vbXNbaV1bcHJvcGVydHlOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQoa2V5c1t2YWxdKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXNbdmFsXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJvb21zW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvb21zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHEnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XHJcbiAgICAgICAgdmFyIExPQ0FMX1RPS0VOID0gJ3Rva2VuJztcclxuICAgICAgICB2YXIgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGF1dGhUb2tlbjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZFVzZXJJbmZvKCkge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oTE9DQUxfVE9LRU4pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9hZGluZyBVc2VyIGluZm8uLi4nKTsvL0RvIHVzdW5pxJljaWFcclxuICAgICAgICAgICAgaWYodG9rZW4pXHJcbiAgICAgICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZXN0cm95VXNlckluZm8oKSB7XHJcbiAgICAgICAgICAgIGF1dGhUb2tlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMT0NBTF9UT0tFTik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdG9yZVVzZXJJbmZvKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShMT0NBTF9UT0tFTiwgdG9rZW4pO1xyXG4gICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1c2VySW5mbyh0b2tlbikge1xyXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBhdXRoVG9rZW4gPSB0b2tlbjtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IGF1dGhUb2tlbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzaWduaW4gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9hdXRoZW50aWNhdGUnLCB1c2VyKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmVVc2VySW5mbyhyZXN1bHQuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICB2YXIgc2lnbm91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVzdHJveVVzZXJJbmZvKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNpZ251cCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3NpZ251cCcsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnamVzdGVtIHcgcmVzb2x2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsb2FkVXNlckluZm8oKTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3VzZXJpbmZvJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyQm9va2luZ3MgPSBmdW5jdGlvbiAoKSB7Ly9UT0RPIHBvcHJhd2nEhyByYXplbSB6IGFwaSDFvGVieSBkYXdhxYJvIHN1Y2Nlc3NcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9nZXRVc2VyQm9va2luZ3MnKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHNpZ25pbjogc2lnbmluLFxyXG4gICAgICAgICAgICBzaWdub3V0OiBzaWdub3V0LFxyXG4gICAgICAgICAgICBzaWdudXA6IHNpZ251cCxcclxuICAgICAgICAgICAgZ2V0VXNlckluZm86IGdldFVzZXJJbmZvLFxyXG4gICAgICAgICAgICBnZXRVc2VyQm9va2luZ3M6IGdldFVzZXJCb29raW5ncygpLFxyXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGlzQXV0aGVudGljYXRlZFxyXG4gICAgICAgIH1cclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDguMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLnNlcnZpY2UoJ29mZmVyU3ZjJywgZnVuY3Rpb24gKCRxLCAkaHR0cCkge1xyXG4gICAgICAgIHZhciBjaG9zZW5Sb29tID0ge307XHJcbiAgICAgICAgdmFyIGV4dHJhcyA9IFtdO1xyXG5cclxuICAgICAgICB2YXIgY2hvb3NlUm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICAgICAgICAgIGNob29zZW5Sb29tID0gcm9vbTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Um9vbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNob29zZW5Sb29tO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRyYXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvZ2V0RXh0cmFzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEuZXh0cmFzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEuZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGNob29zZVJvb206IGNob29zZVJvb20sXHJcbiAgICAgICAgICAgIGdldFJvb206IGdldFJvb20sXHJcbiAgICAgICAgICAgIGdldEV4dHJhczogZ2V0RXh0cmFzLFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDYuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLnNlcnZpY2UoJ3Jvb21TZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkaHR0cCkge1xyXG5cclxuICAgICAgICB2YXIgZ2V0Um9vbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9maW5kUm9vbXMnLCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1BvYnJhbm8gcG9rb2plJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEucm9vbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYm9va1Jvb20gPSBmdW5jdGlvbiAoZGF0YSkgey8vVE9ETyB6amHEhcSHIHNpxJlcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvcmVzZXJ2ZScsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLnN1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLmVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRSb29tczogZ2V0Um9vbXMsXHJcbiAgICAgICAgICAgIGJvb2tSb29tOiBib29rUm9vbVxyXG4gICAgICAgIH1cclxuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
