var app=angular.module("app",["ngRoute","ui.router","ngCookies"]);angular.module("app").factory("authInterceptor",["$window",function(o){return{request:function(e){return e.headers=e.headers||{},o.localStorage.token&&(e.headers.Authorization=o.localStorage.token),e}}}]).config(["$routeProvider","$httpProvider",function(o,e){e.interceptors.push("authInterceptor"),o.when("/",{templateUrl:"/main"}).when("/signup",{templateUrl:"/signup"}).when("/signin",{templateUrl:"/signin"}).when("/userinfo",{templateUrl:"/userinfo"}).when("/successfulSignup",{templateUrl:"/successfulSignup"}).when("/offer",{templateUrl:"/offer"}).when("/confirmation",{templateUrl:"/confirmation"}).otherwise("/")}]),angular.module("app").controller("authCtrl",["$q","$scope","$window","$location","$route","$rootScope","AuthService",function(o,e,t,n,r,a,i){e.regex="(\\+[0-9]\\d{1})*(\\s)*([0-9]\\d{2})(\\s*)([0-9]\\d{2})(\\s*)([0-9]\\d{2})",e.submitError=!1,e.errorMessage="",a.isLoggedIn=function(){return i.isAuthenticated},e.signin=function(){console.log("login"),i.signin(e.user).then(function(o,e){a.isLogedIn=!0,t.location.reload(),console.log(o)})},e.signout=function(){i.signout(),a.isLogedIn=!1,t.location.reload(),console.log("logout")},e.getUserInfo=function(){i.getUserInfo().then(function(o){console.log(o),e.userinfo=o})},e.getUserBookings=function(){i.getUserBookings.then(function(o){console.log(o),e.userBookings=o})},e.submitForm=function(o){o?i.signup(e.user).then(function(o){console.log("Pomyślnie zarejestrowano"),e.submitError=!1,i.signin(e.user).then(function(o,e){a.isLogedIn=!0,"http://localhost:3001/#/confirmation"==t.location.toString()?t.location.reload():t.location.href="#/successfulSignup"})},function(o){switch(console.log(o),o.code){case 11e3:e.submitError=!0,e.errorMessage="Wybrany email jest już zarejestrowany. Proszę wybrać inny.";break;default:e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później."}}):(e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później.")},e.$watch("submitError",function(o){console.log(o)})}]),angular.module("app").controller("confirmationCtrl",["$q","$window","$location","$cookies","$scope","$rootScope","AuthService",function(o,e,t,n,r,a,i){r.isSignedIn=!1,r.room=JSON.parse(n.get("room")),r.dateFrom=JSON.parse(n.get("dates")).dateFrom,r.dateTo=JSON.parse(n.get("dates")).dateTo,r.extras=JSON.parse(n.get("extras")).extras,r.numOfDays=JSON.parse(n.get("extras")).numOfDays;var s=function(){i.isAuthenticated?r.isSignedIn=!0:r.isSignedIn=!1};r.reserve=function(){},s()}]),angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(o,e,t,n){n.$validators.compareTo=function(e){return e==o.otherModelValue},o.$watch("otherModelValue",function(){n.$validate()})}}}),angular.module("app").controller("offerCtrl",["$scope","$cookies","$location","$window","offerSvc",function(o,e,t,n,r){o.offer={},o.extras=[],o.selectedExtras=[];var a={};o.dateFrom="",o.dateTo="",o.roomName="";var i=function(){o.offer=JSON.parse(e.get("room")),o.extras=u(),a=JSON.parse(e.get("dates")),o.dateFrom=s(new Date(a.dateFrom)),o.dateTo=s(new Date(a.dateTo)),o.roomName=o.offer.type,o.roomPrice=o.offer.price,o.extrasTotalPrice=0},s=function(o){var e=o.getUTCDate(),t=o.getUTCMonth()+1,n=o.getUTCFullYear();return""+e+"-"+t+"-"+n};o.addOrRemoveExtra=function(e){var t=o.selectedExtras.indexOf(e);e.buttonText=e.buttonToggle?"Dodaj +":"Usuń -",e.buttonToggle=!e.buttonToggle,t==-1?(o.selectedExtras.push(e),o.extrasTotalPrice+=e.price*c()):(o.selectedExtras.splice(t,1),o.extrasTotalPrice-=e.price*c())},o.toConfirmation=function(){console.log("asdasd");var t={extras:o.selectedExtras,numOfDays:c()};e.put("extras",JSON.stringify(t)),n.location.href="#/confirmation"},o.toPrevious=function(){n.location.href="#/main"};var u=function(){r.getExtras().then(function(e){o.extras=e;for(var t=0;t<o.extras.length;t++)o.extras[t].buttonText="Dodaj +",o.extras[t].buttonToggle=!1})},c=function(){var o=864e5,e=new Date(a.dateFrom),t=new Date(a.dateTo),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((r-n)/o)};i()}]),angular.module("app").controller("roomCtrl",["$q","$cookies","$scope","$window","$location","roomService","offerSvc","$filter",function(o,e,t,n,r,a,i,s){t.dateFrom="",t.dateTo="",t.noRoomsError=!1,t.errorMsg="",t.rooms=[],t.numberOfBeds=1;var u=function(){var o=new Date;console.log(o),t.dateFrom=o;var e=new Date;e.setDate(e.getDate()+1),t.dateTo=e};t.init=function(){u(),t.findRooms()},t.findRooms=function(){a.getRooms({from:t.dateFrom.toISOString(),to:t.dateTo.toISOString(),beds:t.numberOfBeds}).then(function(o){t.rooms=o},function(o){t.noRoomsError=!0,t.errorMsg="Coś poszło nie tak."})},t.addRoom=function(o){e.put("room",JSON.stringify(o)),e.put("dates",JSON.stringify({dateFrom:t.dateFrom,dateTo:t.dateTo})),i.chooseRoom(o),n.location.href="#/offer"},t.test=function(){console.log(t.rooms),t.findRooms()}}]),angular.module("app").filter("uniqueCategories",function(){return function(o,e){if(angular.isArray(o)){for(var t=[],n={},r=0;r<o.length;r++){var a=o[r][e];angular.isUndefined(n[a])&&(n[a]=!0,t.push(o[r]))}return t}return o}}),angular.module("app").service("AuthService",["$http","$q",function(o,e){function t(){var o=window.localStorage.getItem(s);console.log("loading User info..."),o&&a(o)}function n(){i=void 0,u=!1,o.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(s)}function r(o){window.localStorage.setItem(s,o),a(o)}function a(e){u=!0,i=e,o.defaults.headers.common.Authorization=i}var i,s="token",u=!1,c=function(t){return e(function(e,n){o.post("/api/authenticate",t).then(function(o){o.data.success?(r(o.data.token),e(o.data.msg,o.data.success)):n(o.data.msg,o.data.success)})})},l=function(){n()},f=function(t){return e(function(e,n){o.post("/api/signup",t).then(function(o){o.data.success?(console.log("jestem w resolve"),e(o.data.msg)):n(o.data.msg)})})};t();var g=function(){return e(function(e,t){o.get("/api/userinfo").then(function(o){o.data.success?e(o.data.msg):t(o.data.msg)})})},d=function(){return e(function(e,t){o.get("/api/getUserBookings").then(function(o){e(o.data)})})};return{signin:c,signout:l,signup:f,getUserInfo:g,getUserBookings:d(),isAuthenticated:u}}]),angular.module("app").service("offerSvc",["$q","$http",function(o,e){var t=function(o){choosenRoom=o},n=function(){return choosenRoom},r=function(){return o(function(o,t){e.get("/api/getExtras").then(function(e){e.data.success?o(e.data.extras):t(e.data.error)})})};return{chooseRoom:t,getRoom:n,getExtras:r}}]),angular.module("app").service("roomService",["$q","$http",function(o,e){var t=function(t){return o(function(o,n){e.post("/api/findRooms",t).then(function(e){e.data.success?(console.log("Pobrano pokoje"),o(e.data.rooms)):n(e.data.error)})})};return{getRooms:t}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbmZpZy5qcyIsImNvbnRyb2xsZXJzL2F1dGhvcml6YXRpb24uanMiLCJjb250cm9sbGVycy9jb25maXJtYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvZGlyZWN0aXZlcy5qcyIsImNvbnRyb2xsZXJzL29mZmVyQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3Jvb21Db250cm9sbGVyLmpzIiwiZmlsbHRlcnMvcm9vbUZpbHRlci5qcyIsInNlcnZpY2VzL2F1dGhvcml6YXRpb24uc3ZjLmpzIiwic2VydmljZXMvb2ZmZXIuc3ZjLmpzIiwic2VydmljZXMvcm9vbS5zdmMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImZhY3RvcnkiLCIkd2luZG93IiwicmVxdWVzdCIsImNvbmZpZyIsImhlYWRlcnMiLCJsb2NhbFN0b3JhZ2UiLCJ0b2tlbiIsIiRyb3V0ZVByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJjb250cm9sbGVyIiwiJHEiLCIkc2NvcGUiLCIkbG9jYXRpb24iLCIkcm91dGUiLCIkcm9vdFNjb3BlIiwiQXV0aFNlcnZpY2UiLCJyZWdleCIsInN1Ym1pdEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaXNMb2dnZWRJbiIsImlzQXV0aGVudGljYXRlZCIsInNpZ25pbiIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyIiwidGhlbiIsIm1zZyIsInN1Y2Nlc3MiLCJpc0xvZ2VkSW4iLCJsb2NhdGlvbiIsInJlbG9hZCIsInNpZ25vdXQiLCJnZXRVc2VySW5mbyIsInVzZXJpbmZvIiwiZ2V0VXNlckJvb2tpbmdzIiwidXNlckJvb2tpbmdzIiwic3VibWl0Rm9ybSIsImlzVmFsaWQiLCJzaWdudXAiLCJkYXRhIiwidG9TdHJpbmciLCJocmVmIiwiY29kZSIsIiR3YXRjaCIsIiRjb29raWVzIiwiaXNTaWduZWRJbiIsInJvb20iLCJKU09OIiwicGFyc2UiLCJnZXQiLCJkYXRlRnJvbSIsImRhdGVUbyIsImV4dHJhcyIsIm51bU9mRGF5cyIsImluaXQiLCJyZXNlcnZlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJNb2RlbFZhbHVlIiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dGVzIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiY29tcGFyZVRvIiwibW9kZWxWYWx1ZSIsIiR2YWxpZGF0ZSIsIm9mZmVyU3ZjIiwib2ZmZXIiLCJzZWxlY3RlZEV4dHJhcyIsImRhdGVzIiwicm9vbU5hbWUiLCJzaG93T2ZmZXIiLCJnZXRFeHRyYXMiLCJkYXRlUHJlZXRpZnkiLCJEYXRlIiwidHlwZSIsInJvb21QcmljZSIsInByaWNlIiwiZXh0cmFzVG90YWxQcmljZSIsImRhdGUiLCJkYXkiLCJnZXRVVENEYXRlIiwibW9udGgiLCJnZXRVVENNb250aCIsInllYXIiLCJnZXRVVENGdWxsWWVhciIsImFkZE9yUmVtb3ZlRXh0cmEiLCJleHRyYSIsImluZGV4IiwiaW5kZXhPZiIsImJ1dHRvblRleHQiLCJidXR0b25Ub2dnbGUiLCJjYWxjdWxhdGVEaWZmT2ZEYXlzIiwic3BsaWNlIiwidG9Db25maXJtYXRpb24iLCJwdXQiLCJzdHJpbmdpZnkiLCJ0b1ByZXZpb3VzIiwiZXh0cmFzRGF0YSIsImkiLCJsZW5ndGgiLCJNU19QRVJfREFZIiwiZGF0ZUZyb21VVEMiLCJVVEMiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImRhdGVUb1VUQyIsIk1hdGgiLCJmbG9vciIsInJvb21TZXJ2aWNlIiwiJGZpbHRlciIsIm5vUm9vbXNFcnJvciIsImVycm9yTXNnIiwicm9vbXMiLCJudW1iZXJPZkJlZHMiLCJzZXREYXRlIiwiZGF0ZVRlbXAiLCJmaW5kUm9vbXMiLCJnZXRSb29tcyIsImZyb20iLCJ0b0lTT1N0cmluZyIsInRvIiwiYmVkcyIsInJvb21zRGF0YSIsImVycm9yIiwiYWRkUm9vbSIsImNob29zZVJvb20iLCJ0ZXN0IiwiZmlsdGVyIiwicHJvcGVydHlOYW1lIiwiaXNBcnJheSIsInJlc3VsdCIsImtleXMiLCJ2YWwiLCJpc1VuZGVmaW5lZCIsInNlcnZpY2UiLCIkaHR0cCIsImxvYWRVc2VySW5mbyIsIndpbmRvdyIsImdldEl0ZW0iLCJMT0NBTF9UT0tFTiIsInVzZXJJbmZvIiwiZGVzdHJveVVzZXJJbmZvIiwiYXV0aFRva2VuIiwidW5kZWZpbmVkIiwiZGVmYXVsdHMiLCJjb21tb24iLCJyZW1vdmVJdGVtIiwic3RvcmVVc2VySW5mbyIsInNldEl0ZW0iLCJyZXNvbHZlIiwicmVqZWN0IiwicG9zdCIsImNob29zZW5Sb29tIiwiZ2V0Um9vbSJdLCJtYXBwaW5ncyI6IkFBR0EsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxPQUFBLFVBQUEsWUFBQSxhQ0FBRCxTQUFBQyxPQUFBLE9BQ0FDLFFBQUEsbUJBQUEsVUFBQSxTQUFBQyxHQUNBLE9BQ0FDLFFBQUEsU0FBQUMsR0FNQSxNQUxBQSxHQUFBQyxRQUFBRCxFQUFBQyxZQUNBSCxFQUFBSSxhQUFBQyxRQUNBSCxFQUFBQyxRQUFBLGNBQUFILEVBQUFJLGFBQUFDLE9BR0FILE9BS0FBLFFBQUEsaUJBQUEsZ0JBQUEsU0FBQUksRUFBQUMsR0FDQUEsRUFBQUMsYUFBQUMsS0FBQSxtQkFDQUgsRUFDQUksS0FBQSxLQUNBQyxZQUFBLFVBRUFELEtBQUEsV0FDQUMsWUFBQSxZQUVBRCxLQUFBLFdBQ0FDLFlBQUEsWUFFQUQsS0FBQSxhQUNBQyxZQUFBLGNBRUFELEtBQUEscUJBQ0FDLFlBQUEsc0JBRUFELEtBQUEsVUFDQUMsWUFBQSxXQUVBRCxLQUFBLGlCQUNBQyxZQUFBLGtCQUVBQyxVQUFBLFFDdENBZixRQUFBQyxPQUFBLE9BQ0FlLFdBQUEsWUFBQSxLQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUEsYUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFmLEVBQUFnQixFQUFBQyxFQUFBQyxFQUFBQyxHQUdBSixFQUFBSyxNQUFBLDZFQUVB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QUEsRUFDQVUsUUFBQUEsRUFDQU8sT0FBQUEsRUFDQU4sWUFBQUEsRUFDQUUsZ0JBQUFBLElBQ0FkLGdCQUFBQSxNQzNGQTNCLFFBQUFDLE9BQUEsT0FDQWdKLFFBQUEsWUFBQSxLQUFBLFFBQUEsU0FBQWhJLEVBQUFpSSxHQUNBLEdBR0FWLEdBQUEsU0FBQW5GLEdBQ0E4RyxZQUFBOUcsR0FHQStHLEVBQUEsV0FDQSxNQUFBRCxjQUdBbEYsRUFBQSxXQUNBLE1BQUFoRSxHQUFBLFNBQUErSSxFQUFBQyxHQUNBZixFQUFBMUYsSUFBQSxrQkFBQXhCLEtBQUEsU0FBQTZHLEdBQ0FBLEVBQUEvRixLQUFBWixRQUNBOEgsRUFBQW5CLEVBQUEvRixLQUFBYSxRQUVBc0csRUFBQXBCLEVBQUEvRixLQUFBd0YsV0FRQSxRQUNBRSxXQUFBQSxFQUNBNEIsUUFBQUEsRUFDQW5GLFVBQUFBLE1DOUJBakYsUUFBQUMsT0FBQSxPQUNBZ0osUUFBQSxlQUFBLEtBQUEsUUFBQSxTQUFBaEksRUFBQWlJLEdBRUEsR0FBQWxCLEdBQUEsU0FBQWxGLEdBQ0EsTUFBQTdCLEdBQUEsU0FBQStJLEVBQUFDLEdBQ0FmLEVBQUFnQixLQUFBLGlCQUFBcEgsR0FBQWQsS0FBQSxTQUFBNkcsR0FDQUEsRUFBQS9GLEtBQUFaLFNBQ0FMLFFBQUFDLElBQUEsa0JBQ0FrSSxFQUFBbkIsRUFBQS9GLEtBQUE2RSxRQUVBc0MsRUFBQXBCLEVBQUEvRixLQUFBd0YsV0FNQSxRQUNBTixTQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMjIuMDkuMjAxNi5cclxuICovXHJcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ3VpLnJvdXRlcicsICduZ0Nvb2tpZXMnXSk7XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTAuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSAkd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvbWFpbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zaWdudXAnLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWdudXAnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc2lnbmluJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWduaW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvdXNlcmluZm8nLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy91c2VyaW5mbydcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zdWNjZXNzZnVsU2lnbnVwJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zdWNjZXNzZnVsU2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL29mZmVyJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9vZmZlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jb25maXJtYXRpb24nLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2NvbmZpcm1hdGlvbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLm90aGVyd2lzZSgnLycpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdhdXRoQ3RybCcsIGZ1bmN0aW9uICgkcSwgJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sICRyb3V0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS5yZWdleCA9ICcoXFxcXCtbMC05XVxcXFxkezF9KSooXFxcXHMpKihbMC05XVxcXFxkezJ9KShcXFxccyopKFswLTldXFxcXGR7Mn0pKFxcXFxzKikoWzAtOV1cXFxcZHsyfSknO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuaXNMb2dnZWRJbiA9IGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaWduaW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dpbicpO1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5zaWduaW4oJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKG1zZywgc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pc0xvZ2VkSW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8kd2luZG93LmxvY2F0aW9uLmhyZWY9JyMvJztcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaWdub3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5zaWdub3V0KCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gZmFsc2U7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dvdXQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0VXNlckluZm8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldFVzZXJJbmZvKCkudGhlbihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJpbmZvID0gbXNnO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRVc2VyQm9va2luZ3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldFVzZXJCb29raW5ncy50aGVuKGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlckJvb2tpbmdzID0gbXNnO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdWJtaXRGb3JtID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYoaXNWYWxpZCl7XHJcbiAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zaWdudXAoJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9tecWbbG5pZSB6YXJlamVzdHJvd2FubycpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ25pbigkc2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAobXNnLCBzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpID09ICdodHRwOi8vbG9jYWxob3N0OjMwMDEvIy9jb25maXJtYXRpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL3N1Y2Nlc3NmdWxTaWdudXAnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGRhdGEuY29kZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTEwMDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdXeWJyYW55IGVtYWlsIGplc3QganXFvCB6YXJlamVzdHJvd2FueS4gUHJvc3rEmSB3eWJyYcSHIGlubnkuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnVXBzcyBjb8WbIHBvc3rFgm8gbmllIHRhay4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBww7PFum5pZWouJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ1Vwc3MgY2/FmyBwb3N6xYJvIG5pZSB0YWsuIFByb3N6xJkgc3Byw7Nib3dhxIcgcMOzxbpuaWVqLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdzdWJtaXRFcnJvcicsIGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3JNZXNzYWdlKVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2NvbmZpcm1hdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHEsICR3aW5kb3csICRsb2NhdGlvbiwgJGNvb2tpZXMsICRzY29wZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmlzU2lnbmVkSW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJvb20gPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgncm9vbScpKTtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZGF0ZXMnKSkuZGF0ZUZyb207XHJcbiAgICAgICAgJHNjb3BlLmRhdGVUbyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKS5kYXRlVG87XHJcbiAgICAgICAgJHNjb3BlLmV4dHJhcyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdleHRyYXMnKSkuZXh0cmFzO1xyXG4gICAgICAgICRzY29wZS5udW1PZkRheXMgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZXh0cmFzJykpLm51bU9mRGF5cztcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCA/ICRzY29wZS5pc1NpZ25lZEluID0gdHJ1ZSA6ICRzY29wZS5pc1NpZ25lZEluID0gZmFsc2U7XHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICRzY29wZS5yZXNlcnZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL1RPRE8genJvYmllbmllIHJlamVzdHJhY2ppKG1vxbxlIHByemVuaWVzaWVuaWUgbmEgc2lnbnVwIHZpZXc/IGRvIHJvendhxbxlbmlhKSBpIG9ic8WCdWdhIGLFgsSZZMOzdyhtb8W8ZSBqYWtvxZsgcG/FgsSFY3p5xIcgb2J5ZHdhIGxvZ293YW5pYSBpIHJlamVzdHJhY2plIHcgamVkbm8/KVxyXG4gICAgICAgIC8vVE9ETyBwb3JvYmllbmllIGkgcHJ6ZXRlc3Rvd2FuaWUgcmVmZXJlbmNqaSB3IG1vbmdvZGIgaSB6cm9iaWVuaWUgbm93ZWoga29sZWtjamkgaSBwb3R3aWVyZHpvbnltaSByZXplcndhY2phbWkoemFzdGFub3dpxIcgc2nEmSBuYWQgYmF6xIUgZGFueWNoKVxyXG4gICAgICAgIC8vVE9ETyBwcnplasWbY2llIGRvIHVkYW5laiByZXplcndhY2ppIHR5bGtvIGplc2xpIHNpZSB6YWFrY2VwdHVqZSByZWd1bGFtaW5cclxuICAgICAgICAvL1RPRE8gT2JzbHVnYSBibGVkb3cgcmV6ZXJ3YWNqaVxyXG4gICAgICAgIC8vVE9ETyBkb2RhbmllIGN6ZWdvcyBkbyB3aWRva3UgcmV6ZXJ3YWpjaVxyXG4gICAgICAgIC8vVE9ETyBkb2RhbmllIGNhxYJlaiBvYnPFgnVnaSBrb250YSh6bWlhbmEgaGFzxYJhLCBudW1lcnUgdGVsZWZvbnVbZG9kYW5pZSBsdWIgem1pYW5hXSwgcG9kZ2zEhWR1IHJlemVyd2FjamksIGl0cCkgb3JheiBvYnPFgnVnaSBob3RlbHUoQ1JVRCBkb2RhdGvDs3csIHBva29qaSBpdHApLlxyXG4gICAgICAgIC8vVE9ETyBkb2RhbmllIG1vxbxlIGpha2nFmyB3eWtyZXPDs3cgbmEgdGVtYXQgb2JjacSFxbxlbmlhIHBva29qaSBsdWIgamFracWbIHByenljaG9kw7N3IGN6eSBjb8WbIGFsYm8gamFpZcWbIGNvxZsgZG8gZ2VuZXJvd2FuaWUgcGRmIHogcmFwb3J0ZW1cclxuICAgICAgICAvL1RPRE8gcG96bWllbmlhxIcgc8WCb3dhIHJlc2VydmF0aW9uIGl0cCBuYSBib29raW5nXHJcbiAgICAgICAgaW5pdCgpO1xyXG5cclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmRpcmVjdGl2ZSgnY29tcGFyZVRvJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgb3RoZXJNb2RlbFZhbHVlOiBcIj1jb21wYXJlVG9cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgbmdNb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY29tcGFyZVRvID0gZnVuY3Rpb24obW9kZWxWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09IHNjb3BlLm90aGVyTW9kZWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwib3RoZXJNb2RlbFZhbHVlXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA4LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdvZmZlckN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkY29va2llcywgJGxvY2F0aW9uLCAkd2luZG93LCBvZmZlclN2Yykge1xyXG4gICAgICAgICRzY29wZS5vZmZlciA9IHt9O1xyXG4gICAgICAgICRzY29wZS5leHRyYXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMgPSBbXTtcclxuICAgICAgICB2YXIgZGF0ZXMgPSB7fTtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSAnJztcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLnJvb21OYW1lID0gJyc7XHJcblxyXG5cclxuICAgICAgICB2YXIgc2hvd09mZmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUub2ZmZXIgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgncm9vbScpKTtcclxuICAgICAgICAgICAgJHNjb3BlLmV4dHJhcyA9IGdldEV4dHJhcygpO1xyXG5cclxuICAgICAgICAgICAgZGF0ZXMgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZGF0ZXMnKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlRnJvbSA9IGRhdGVQcmVldGlmeShuZXcgRGF0ZShkYXRlcy5kYXRlRnJvbSkpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZVRvID0gZGF0ZVByZWV0aWZ5KG5ldyBEYXRlKGRhdGVzLmRhdGVUbykpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnJvb21OYW1lID0gJHNjb3BlLm9mZmVyLnR5cGU7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tUHJpY2UgPSAkc2NvcGUub2ZmZXIucHJpY2U7XHJcbiAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlID0gMDtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRhdGVQcmVldGlmeSA9IGZ1bmN0aW9uIChkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcclxuICAgICAgICAgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRVVENNb250aCgpICsgMTtcclxuICAgICAgICAgICAgdmFyIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XHJcbiAgICAgICAgICAgIHJldHVybiAnJytkYXkrJy0nK21vbnRoKyctJyt5ZWFyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5hZGRPclJlbW92ZUV4dHJhID0gZnVuY3Rpb24gKGV4dHJhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMuaW5kZXhPZihleHRyYSk7XHJcbiAgICAgICAgICAgIGV4dHJhLmJ1dHRvblRleHQgPSBleHRyYS5idXR0b25Ub2dnbGUgPyAnRG9kYWogKycgOiAnVXN1xYQgLSc7XHJcbiAgICAgICAgICAgIGV4dHJhLmJ1dHRvblRvZ2dsZSA9ICFleHRyYS5idXR0b25Ub2dnbGU7XHJcblxyXG4gICAgICAgICAgICBpZihpbmRleCA9PSAtMSl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMucHVzaChleHRyYSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzVG90YWxQcmljZSArPSAoZXh0cmEucHJpY2UgKiBjYWxjdWxhdGVEaWZmT2ZEYXlzKCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXh0cmFzLnNwbGljZShpbmRleCwxKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlIC09IChleHRyYS5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG9Db25maXJtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhc2Rhc2QnKTtcclxuICAgICAgICAgICAgdmFyIGV4dHJhcyA9IHtleHRyYXM6ICRzY29wZS5zZWxlY3RlZEV4dHJhcywgbnVtT2ZEYXlzOiBjYWxjdWxhdGVEaWZmT2ZEYXlzKCl9O1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ2V4dHJhcycsIEpTT04uc3RyaW5naWZ5KGV4dHJhcykpO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIy9jb25maXJtYXRpb24nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvUHJldmlvdXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjL21haW4nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dHJhcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgb2ZmZXJTdmMuZ2V0RXh0cmFzKCkudGhlbihmdW5jdGlvbiAoZXh0cmFzRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhcyA9IGV4dHJhc0RhdGE7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwIDsgaSA8ICRzY29wZS5leHRyYXMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNbaV0uYnV0dG9uVGV4dCA9ICdEb2RhaiArJztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzW2ldLmJ1dHRvblRvZ2dsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY2FsY3VsYXRlRGlmZk9mRGF5cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIE1TX1BFUl9EQVkgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xyXG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSBuZXcgRGF0ZShkYXRlcy5kYXRlRnJvbSk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlVG8gPSBuZXcgRGF0ZShkYXRlcy5kYXRlVG8pO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZUZyb21VVEMgPSBEYXRlLlVUQyhkYXRlRnJvbS5nZXRGdWxsWWVhcigpLCBkYXRlRnJvbS5nZXRNb250aCgpLCBkYXRlRnJvbS5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZVRvVVRDID0gRGF0ZS5VVEMoZGF0ZVRvLmdldEZ1bGxZZWFyKCksIGRhdGVUby5nZXRNb250aCgpLCBkYXRlVG8uZ2V0RGF0ZSgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKGRhdGVUb1VUQyAtIGRhdGVGcm9tVVRDKSAvIE1TX1BFUl9EQVkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNob3dPZmZlcigpO1xyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA2LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdyb29tQ3RybCcsIGZ1bmN0aW9uICgkcSwgJGNvb2tpZXMsICRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCByb29tU2VydmljZSwgb2ZmZXJTdmMsJGZpbHRlcikge1xyXG4gICAgICAgICRzY29wZS5kYXRlRnJvbSA9ICcnO1xyXG4gICAgICAgICRzY29wZS5kYXRlVG8gPSAnJztcclxuICAgICAgICAkc2NvcGUubm9Sb29tc0Vycm9yID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmVycm9yTXNnID0nJztcclxuICAgICAgICAkc2NvcGUucm9vbXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUubnVtYmVyT2ZCZWRzID0gMTtcclxuXHJcblxyXG4gICAgICAgIHZhciBzZXREYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGUpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSBkYXRlO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZVRlbXAgPSBuZXcgRGF0ZTtcclxuICAgICAgICAgICAgZGF0ZVRlbXAuc2V0RGF0ZShkYXRlVGVtcC5nZXREYXRlKCkrMSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlVG8gPSBkYXRlVGVtcDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2V0RGF0ZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZmluZFJvb21zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmZpbmRSb29tcyA9IGZ1bmN0aW9uICgpIHsvL1RPRE8gV3nFm3dpZXRsZW5pZSBlcnJvcmEgbyBicmFrdSBwb2tvamkgbyB3eWJyYW55Y2ggcGFyYW1ldHJhY2ggdcW8eXdhasSFYyBub1Jvb21zRXJyb3IgaSBuZy1IaWRlXHJcbiAgICAgICAgICAgIHJvb21TZXJ2aWNlLmdldFJvb21zKHtcclxuICAgICAgICAgICAgICAgIGZyb206ICRzY29wZS5kYXRlRnJvbS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgdG86ICRzY29wZS5kYXRlVG8udG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIGJlZHM6ICRzY29wZS5udW1iZXJPZkJlZHNcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocm9vbXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucm9vbXMgPSByb29tc0RhdGE7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vUm9vbXNFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNc2cgPSAnQ2/FmyBwb3N6xYJvIG5pZSB0YWsuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuYWRkUm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgncm9vbScsIEpTT04uc3RyaW5naWZ5KHJvb20pKTtcclxuICAgICAgICAgICAgJGNvb2tpZXMucHV0KCdkYXRlcycsIEpTT04uc3RyaW5naWZ5KHtkYXRlRnJvbTogJHNjb3BlLmRhdGVGcm9tLCBkYXRlVG86ICRzY29wZS5kYXRlVG99KSk7XHJcbiAgICAgICAgICAgIG9mZmVyU3ZjLmNob29zZVJvb20ocm9vbSk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZj0nIy9vZmZlcic7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5yb29tcyk7XHJcbiAgICAgICAgICAgICRzY29wZS5maW5kUm9vbXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA3LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5maWx0ZXIoJ3VuaXF1ZUNhdGVnb3JpZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyb29tcywgcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNBcnJheShyb29tcykpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSB7fTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCByb29tcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IHJvb21zW2ldW3Byb3BlcnR5TmFtZV1cclxuICAgICAgICAgICAgICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKGtleXNbdmFsXSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzW3ZhbF0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyb29tc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByb29tcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxNC4xMC4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnQXV0aFNlcnZpY2UnLCBbJyRodHRwJywgJyRxJywgZnVuY3Rpb24gKCRodHRwLCAkcSkge1xyXG4gICAgICAgIHZhciBMT0NBTF9UT0tFTiA9ICd0b2tlbic7XHJcbiAgICAgICAgdmFyIGlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBhdXRoVG9rZW47XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRVc2VySW5mbygpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKExPQ0FMX1RPS0VOKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvYWRpbmcgVXNlciBpbmZvLi4uJyk7Ly9EbyB1c3VuacSZY2lhXHJcbiAgICAgICAgICAgIGlmKHRva2VuKVxyXG4gICAgICAgICAgICAgICAgdXNlckluZm8odG9rZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGVzdHJveVVzZXJJbmZvKCkge1xyXG4gICAgICAgICAgICBhdXRoVG9rZW4gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oTE9DQUxfVE9LRU4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3RvcmVVc2VySW5mbyh0b2tlbikge1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oTE9DQUxfVE9LRU4sIHRva2VuKTtcclxuICAgICAgICAgICAgdXNlckluZm8odG9rZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXNlckluZm8odG9rZW4pIHtcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgYXV0aFRva2VuID0gdG9rZW47XHJcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSBhdXRoVG9rZW47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc2lnbmluID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvYXV0aGVudGljYXRlJywgdXNlcikudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlVXNlckluZm8ocmVzdWx0LmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLm1zZywgcmVzdWx0LmRhdGEuc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZywgcmVzdWx0LmRhdGEuc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBcclxuXHJcbiAgICAgICAgdmFyIHNpZ25vdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGRlc3Ryb3lVc2VySW5mbygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzaWdudXAgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9zaWdudXAnLCB1c2VyKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2plc3RlbSB3IHJlc29sdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5tc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5tc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbG9hZFVzZXJJbmZvKCk7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VySW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS91c2VyaW5mbycpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckJvb2tpbmdzID0gZnVuY3Rpb24gKCkgey8vVE9ETyBwb3ByYXdpxIcgcmF6ZW0geiBhcGkgxbxlYnkgZGF3YcWCbyBzdWNjZXNzXHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvZ2V0VXNlckJvb2tpbmdzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBzaWduaW46IHNpZ25pbixcclxuICAgICAgICAgICAgc2lnbm91dDogc2lnbm91dCxcclxuICAgICAgICAgICAgc2lnbnVwOiBzaWdudXAsXHJcbiAgICAgICAgICAgIGdldFVzZXJJbmZvOiBnZXRVc2VySW5mbyxcclxuICAgICAgICAgICAgZ2V0VXNlckJvb2tpbmdzOiBnZXRVc2VyQm9va2luZ3MoKSxcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBpc0F1dGhlbnRpY2F0ZWRcclxuICAgICAgICB9XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA4LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdvZmZlclN2YycsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcclxuICAgICAgICB2YXIgY2hvc2VuUm9vbSA9IHt9O1xyXG4gICAgICAgIHZhciBleHRyYXMgPSBbXTtcclxuXHJcbiAgICAgICAgdmFyIGNob29zZVJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBjaG9vc2VuUm9vbSA9IHJvb207XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFJvb20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjaG9vc2VuUm9vbTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0cmFzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2dldEV4dHJhcycpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLmV4dHJhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBjaG9vc2VSb29tOiBjaG9vc2VSb29tLFxyXG4gICAgICAgICAgICBnZXRSb29tOiBnZXRSb29tLFxyXG4gICAgICAgICAgICBnZXRFeHRyYXM6IGdldEV4dHJhcyxcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA2LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdyb29tU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcclxuXHJcbiAgICAgICAgdmFyIGdldFJvb21zID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvZmluZFJvb21zJywgZGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQb2JyYW5vIHBva29qZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLnJvb21zKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEuZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRSb29tczogZ2V0Um9vbXNcclxuICAgICAgICB9XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
