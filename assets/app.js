var app=angular.module("app",["ngRoute","ui.router","ngCookies"]);angular.module("app").factory("authInterceptor",["$window",function(o){return{request:function(e){return e.headers=e.headers||{},o.localStorage.token&&(e.headers.Authorization=o.localStorage.token),e}}}]).config(["$stateProvider","$urlRouterProvider",function(o,e){o.state("home",{url:"/main",controller:"roomCtrl",templateUrl:"main"}).state("offer",{url:"/offer",controller:"offerCtrl",templateUrl:"offer"}).state("confirmation",{url:"/confirmation",templateUrl:"confirmation"}).state("successfulBooking",{url:"/successfulBooking",templateUrl:"successfulBooking"}).state("successfulSignup",{url:"/successfulSignup",templateUrl:"successfulSignup"}).state("account",{url:"/account",templateUrl:"account"}).state("signin",{url:"/signin",templateUrl:"signin"}).state("signup",{url:"/signup",templateUrl:"signup"}).state("account.bookings",{url:"/bookings",templateUrl:"bookings"}).state("account.details",{url:"/details",templateUrl:"details"}).state("account.changePassword",{url:"/changePassword",templateUrl:"changePassword"}),e.otherwise("/main")}]).run(["$rootScope","$state","$stateParams",function(o,e,t){o.$state=e,o.$stateParams=t}]),angular.module("app").controller("accCtrl",["$scope","AuthService",function(o,e){var t=function(){e.getUserBookings().then(function(e){console.log(e),o.userBookings=e})},n=function(){e.getUserInfo().then(function(e){console.log(e),o.firstName=e.firstName,o.lastName=e.lastName,o.email=e.email,o.phone=e.phone})};n(),t()}]),angular.module("app").controller("authCtrl",["$q","$scope","$state","$window","$location","$route","$rootScope","AuthService",function(o,e,t,n,r,a,s,i){e.regex="(\\+[0-9]\\d{1})*(\\s)*([0-9]\\d{2})(\\s*)([0-9]\\d{2})(\\s*)([0-9]\\d{2})",e.submitError=!1,e.errorMessage="",s.isLoggedIn=function(){return i.isAuthenticated},e.signin=function(){console.log("login"),i.signin(e.user).then(function(o,e){s.isLogedIn=!0,n.location.reload(),console.log(o)})},e.signout=function(){i.signout(),s.isLogedIn=!1,t.go("home").then(function(){n.location.reload()}),console.log("logout")},e.getUserInfo=function(){i.getUserInfo().then(function(o){console.log(o),e.userinfo=o})},e.submitForm=function(o){o?i.signup(e.user).then(function(o){console.log("Pomyślnie zarejestrowano"),e.submitError=!1,i.signin(e.user).then(function(o,e){s.isLogedIn=!0,"http://localhost:3001/#/confirmation"==n.location.toString()?n.location.reload():n.location.href="#/successfulSignup"})},function(o){switch(console.log(o),o.code){case 11e3:e.submitError=!0,e.errorMessage="Wybrany email jest już zarejestrowany. Proszę wybrać inny.";break;default:e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później."}}):(e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później.")},e.$watch("submitError",function(o){console.log(o)})}]),angular.module("app").controller("confirmationCtrl",["$q","$window","$location","$state","$cookies","$scope","$rootScope","AuthService","roomService",function(o,e,t,n,r,a,s,i,u){a.isSignedIn=!1,a.room=JSON.parse(r.get("room")),a.dateFrom=JSON.parse(r.get("dates")).dateFrom,a.dateTo=JSON.parse(r.get("dates")).dateTo,a.extras=JSON.parse(r.get("extras")).extras,a.numOfDays=JSON.parse(r.get("extras")).numOfDays;var c=function(){i.isAuthenticated?a.isSignedIn=!0:a.isSignedIn=!1};a.reserve=function(){1!=a.terms?alert("Przed potwierdzeniem rezerwacji należy zaakceptowaćregulamin."):u.bookRoom({id:a.room._id,from:a.dateFrom,to:a.dateTo,price:l(),extras:a.extras}).then(function(){n.go("successfulBooking")},function(o){})},a.toPrevious=function(){n.go("offer")};var l=function(){var o=0;return o=a.room.price*a.numOfDays,a.extras.forEach(function(e){o+=e.price*a.numOfDays}),o};c()}]),angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(o,e,t,n){n.$validators.compareTo=function(e){return e==o.otherModelValue},o.$watch("otherModelValue",function(){n.$validate()})}}}).directive("userInfo",function(){return{template:"<p>sialala</p>"}}),angular.module("app").controller("offerCtrl",["$scope","$cookies","$state","$location","$window","offerSvc",function(o,e,t,n,r,a){o.offer={},o.extras=[],o.selectedExtras=[];var s={};o.dateFrom="",o.dateTo="",o.roomName="";var i=function(){o.offer=JSON.parse(e.get("room")),o.extras=c(),s=JSON.parse(e.get("dates")),o.dateFrom=u(new Date(s.dateFrom)),o.dateTo=u(new Date(s.dateTo)),o.roomName=o.offer.type,o.roomPrice=o.offer.price*l(),o.extrasTotalPrice=0},u=function(o){var e=o.getUTCDate(),t=o.getUTCMonth()+1,n=o.getUTCFullYear();return""+e+"-"+t+"-"+n};o.addOrRemoveExtra=function(e){var t=o.selectedExtras.indexOf(e);e.buttonText=e.buttonToggle?"Dodaj +":"Usuń -",e.buttonToggle=!e.buttonToggle,t==-1?(o.selectedExtras.push(e),o.extrasTotalPrice+=e.price*l()):(o.selectedExtras.splice(t,1),o.extrasTotalPrice-=e.price*l())},o.toConfirmation=function(){console.log("asdasd");var n={extras:o.selectedExtras,numOfDays:l()};e.put("extras",JSON.stringify(n)),t.go("confirmation")},o.toPrevious=function(){t.go("home")};var c=function(){a.getExtras().then(function(e){o.extras=e;for(var t=0;t<o.extras.length;t++)o.extras[t].buttonText="Dodaj +",o.extras[t].buttonToggle=!1})},l=function(){var o=864e5,e=new Date(s.dateFrom),t=new Date(s.dateTo),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((r-n)/o)};i()}]),angular.module("app").controller("roomCtrl",["$q","$cookies","$scope","$window","$location","roomService","offerSvc","$filter","$state",function(o,e,t,n,r,a,s,i,u){t.dateFrom="",t.dateTo="",t.noRoomsError=!1,t.errorMsg="",t.rooms=[],t.numberOfBeds=1;var c=function(){var o=new Date;console.log(o),t.dateFrom=o;var e=new Date;e.setDate(e.getDate()+1),t.dateTo=e};t.init=function(){c(),t.findRooms()},t.findRooms=function(){a.getRooms({from:t.dateFrom.toISOString(),to:t.dateTo.toISOString(),beds:t.numberOfBeds}).then(function(o){t.rooms=o},function(o){t.noRoomsError=!0,t.errorMsg="Coś poszło nie tak."})},t.addRoom=function(o){e.put("room",JSON.stringify(o)),e.put("dates",JSON.stringify({dateFrom:t.dateFrom,dateTo:t.dateTo})),s.chooseRoom(o),u.go("offer")},t.test=function(){console.log(t.rooms),t.findRooms()}}]),angular.module("app").filter("uniqueCategories",function(){return function(o,e){if(angular.isArray(o)){for(var t=[],n={},r=0;r<o.length;r++){var a=o[r][e];angular.isUndefined(n[a])&&(n[a]=!0,t.push(o[r]))}return t}return o}}),angular.module("app").service("AuthService",["$http","$q",function(o,e){function t(){var o=window.localStorage.getItem(i);console.log("loading User info..."),o&&a(o)}function n(){s=void 0,u=!1,o.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(i)}function r(o){window.localStorage.setItem(i,o),a(o)}function a(e){u=!0,s=e,o.defaults.headers.common.Authorization=s}var s,i="token",u=!1,c=function(t){return e(function(e,n){o.post("/api/authenticate",t).then(function(o){o.data.success?(r(o.data.token),e(o.data.msg,o.data.success)):n(o.data.msg,o.data.success)})})},l=function(){n()},f=function(t){return e(function(e,n){o.post("/api/signup",t).then(function(o){o.data.success?(console.log("jestem w resolve"),e(o.data.msg)):n(o.data.msg)})})};t();var g=function(){return e(function(e,t){o.get("/api/userinfo").then(function(o){o.data.success?e({firstName:o.data.firstName,lastName:o.data.lastName,email:o.data.email,phone:o.data.phone}):t(o.data.msg)})})},d=function(){return e(function(e,t){o.get("/api/getUserBookings").then(function(o){e(o.data)})})};return{signin:c,signout:l,signup:f,getUserInfo:g,getUserBookings:d,isAuthenticated:u}}]),angular.module("app").service("offerSvc",["$q","$http",function(o,e){var t=function(o){choosenRoom=o},n=function(){return choosenRoom},r=function(){return o(function(o,t){e.get("/api/getExtras").then(function(e){e.data.success?o(e.data.extras):t(e.data.error)})})};return{chooseRoom:t,getRoom:n,getExtras:r}}]),angular.module("app").service("roomService",["$q","$http",function(o,e){var t=function(t){return o(function(o,n){e.post("/api/findRooms",t).then(function(e){e.data.success?(console.log("Pobrano pokoje"),o(e.data.rooms)):n(e.data.error)})})},n=function(t){return o(function(o,n){e.post("/api/reserve",t).then(function(e){e.data.success?o(e.data.success):n(e.data.error)})})};return{getRooms:t,bookRoom:n}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbmZpZy5qcyIsImNvbnRyb2xsZXJzL2FjY291bnRDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aG9yaXphdGlvbi5qcyIsImNvbnRyb2xsZXJzL2NvbmZpcm1hdGlvbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9kaXJlY3RpdmVzLmpzIiwiY29udHJvbGxlcnMvb2ZmZXJDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcm9vbUNvbnRyb2xsZXIuanMiLCJmaWxsdGVycy9yb29tRmlsdGVyLmpzIiwic2VydmljZXMvYXV0aG9yaXphdGlvbi5zdmMuanMiLCJzZXJ2aWNlcy9vZmZlci5zdmMuanMiLCJzZXJ2aWNlcy9yb29tLnN2Yy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiZmFjdG9yeSIsIiR3aW5kb3ciLCJyZXF1ZXN0IiwiY29uZmlnIiwiaGVhZGVycyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsImNvbnRyb2xsZXIiLCJ0ZW1wbGF0ZVVybCIsIm90aGVyd2lzZSIsInJ1biIsIiRyb290U2NvcGUiLCIkc3RhdGUiLCIkc3RhdGVQYXJhbXMiLCIkc2NvcGUiLCJBdXRoU2VydmljZSIsImdldFVzZXJCb29raW5ncyIsInRoZW4iLCJtc2ciLCJjb25zb2xlIiwibG9nIiwidXNlckJvb2tpbmdzIiwiZ2V0SW5mbyIsImdldFVzZXJJbmZvIiwidXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiZW1haWwiLCJwaG9uZSIsIiRxIiwiJGxvY2F0aW9uIiwiJHJvdXRlIiwicmVnZXgiLCJzdWJtaXRFcnJvciIsImVycm9yTWVzc2FnZSIsImlzTG9nZ2VkSW4iLCJpc0F1dGhlbnRpY2F0ZWQiLCJzaWduaW4iLCJzdWNjZXNzIiwiaXNMb2dlZEluIiwibG9jYXRpb24iLCJyZWxvYWQiLCJzaWdub3V0IiwiZ28iLCJ1c2VyaW5mbyIsInN1Ym1pdEZvcm0iLCJpc1ZhbGlkIiwic2lnbnVwIiwiZGF0YSIsInRvU3RyaW5nIiwiaHJlZiIsImNvZGUiLCIkd2F0Y2giLCIkY29va2llcyIsInJvb21TZXJ2aWNlIiwiaXNTaWduZWRJbiIsInJvb20iLCJKU09OIiwicGFyc2UiLCJnZXQiLCJkYXRlRnJvbSIsImRhdGVUbyIsImV4dHJhcyIsIm51bU9mRGF5cyIsImluaXQiLCJyZXNlcnZlIiwidGVybXMiLCJhbGVydCIsImJvb2tSb29tIiwiaWQiLCJfaWQiLCJmcm9tIiwidG8iLCJwcmljZSIsImNhbGN1bGF0ZVRvdGFsUHJpY2UiLCJlcnJvciIsInRvUHJldmlvdXMiLCJ0b3RhbCIsImZvckVhY2giLCJlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJNb2RlbFZhbHVlIiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dGVzIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiY29tcGFyZVRvIiwibW9kZWxWYWx1ZSIsIiR2YWxpZGF0ZSIsInRlbXBsYXRlIiwib2ZmZXJTdmMiLCJvZmZlciIsInNlbGVjdGVkRXh0cmFzIiwiZGF0ZXMiLCJyb29tTmFtZSIsInNob3dPZmZlciIsImdldEV4dHJhcyIsImRhdGVQcmVldGlmeSIsIkRhdGUiLCJ0eXBlIiwicm9vbVByaWNlIiwiY2FsY3VsYXRlRGlmZk9mRGF5cyIsImV4dHJhc1RvdGFsUHJpY2UiLCJkYXRlIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsIm1vbnRoIiwiZ2V0VVRDTW9udGgiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJhZGRPclJlbW92ZUV4dHJhIiwiZXh0cmEiLCJpbmRleCIsImluZGV4T2YiLCJidXR0b25UZXh0IiwiYnV0dG9uVG9nZ2xlIiwicHVzaCIsInNwbGljZSIsInRvQ29uZmlybWF0aW9uIiwicHV0Iiwic3RyaW5naWZ5IiwiZXh0cmFzRGF0YSIsImkiLCJsZW5ndGgiLCJNU19QRVJfREFZIiwiZGF0ZUZyb21VVEMiLCJVVEMiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImRhdGVUb1VUQyIsIk1hdGgiLCJmbG9vciIsIiRmaWx0ZXIiLCJub1Jvb21zRXJyb3IiLCJlcnJvck1zZyIsInJvb21zIiwibnVtYmVyT2ZCZWRzIiwic2V0RGF0ZSIsImRhdGVUZW1wIiwiZmluZFJvb21zIiwiZ2V0Um9vbXMiLCJ0b0lTT1N0cmluZyIsImJlZHMiLCJyb29tc0RhdGEiLCJhZGRSb29tIiwiY2hvb3NlUm9vbSIsInRlc3QiLCJmaWx0ZXIiLCJwcm9wZXJ0eU5hbWUiLCJpc0FycmF5IiwicmVzdWx0Iiwia2V5cyIsInZhbCIsImlzVW5kZWZpbmVkIiwic2VydmljZSIsIiRodHRwIiwibG9hZFVzZXJJbmZvIiwid2luZG93IiwiZ2V0SXRlbSIsIkxPQ0FMX1RPS0VOIiwidXNlckluZm8iLCJkZXN0cm95VXNlckluZm8iLCJhdXRoVG9rZW4iLCJ1bmRlZmluZWQiLCJkZWZhdWx0cyIsImNvbW1vbiIsInJlbW92ZUl0ZW0iLCJzdG9yZVVzZXJJbmZvIiwic2V0SXRlbSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0IiwiY2hvb3NlblJvb20iLCJnZXRSb29tIl0sIm1hcHBpbmdzIjoiQUFHQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsVUFBQSxZQUFBLGFDQUFELFNBQUFDLE9BQUEsT0FDQUMsUUFBQSxtQkFBQSxVQUFBLFNBQUFDLEdBQ0EsT0FDQUMsUUFBQSxTQUFBQyxHQU1BLE1BTEFBLEdBQUFDLFFBQUFELEVBQUFDLFlBQ0FILEVBQUFJLGFBQUFDLFFBQ0FILEVBQUFDLFFBQUEsY0FBQUgsRUFBQUksYUFBQUMsT0FHQUgsT0FLQUEsUUFBQSxpQkFBQSxxQkFBQSxTQUFBSSxFQUFBQyxHQUNBRCxFQUNBRSxNQUFBLFFBQ0FDLElBQUEsUUFDQUMsV0FBQSxXQUNBQyxZQUFBLFNBRUFILE1BQUEsU0FDQUMsSUFBQSxTQUNBQyxXQUFBLFlBQ0FDLFlBQUEsVUFFQUgsTUFBQSxnQkFDQUMsSUFBQSxnQkFDQUUs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QUFBa0ksR0FFQSxHQUFBZixHQUFBLFNBQUFoRyxHQUNBLE1BQUFuQixHQUFBLFNBQUFnSixFQUFBQyxHQUNBZixFQUFBZ0IsS0FBQSxpQkFBQS9ILEdBQUEvQixLQUFBLFNBQUF5SSxHQUNBQSxFQUFBMUcsS0FBQVYsU0FDQW5CLFFBQUFDLElBQUEsa0JBQ0F5SixFQUFBbkIsRUFBQTFHLEtBQUEyRixRQUVBbUMsRUFBQXBCLEVBQUExRyxLQUFBMkIsWUFNQVAsRUFBQSxTQUFBcEIsR0FDQSxNQUFBbkIsR0FBQSxTQUFBZ0osRUFBQUMsR0FDQWYsRUFBQWdCLEtBQUEsZUFBQS9ILEdBQUEvQixLQUFBLFNBQUF5SSxHQUNBQSxFQUFBMUcsS0FBQVYsUUFDQXVJLEVBQUFuQixFQUFBMUcsS0FBQVYsU0FFQXdJLEVBQUFwQixFQUFBMUcsS0FBQTJCLFdBTUEsUUFDQXFFLFNBQUFBLEVBQ0E1RSxTQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMjIuMDkuMjAxNi5cclxuICovXHJcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ3VpLnJvdXRlcicsICduZ0Nvb2tpZXMnXSk7XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTEuMTAuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSAkd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJyx7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbWFpbicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAncm9vbUN0cmwnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtYWluJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ29mZmVyJyx7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvb2ZmZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ29mZmVyQ3RybCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ29mZmVyJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvbmZpcm1hdGlvbicse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2NvbmZpcm1hdGlvbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbmZpcm1hdGlvbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzdWNjZXNzZnVsQm9va2luZycse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3N1Y2Nlc3NmdWxCb29raW5nJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3VjY2Vzc2Z1bEJvb2tpbmcnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc3VjY2Vzc2Z1bFNpZ251cCcse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3N1Y2Nlc3NmdWxTaWdudXAnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzdWNjZXNzZnVsU2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2FjY291bnQnLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hY2NvdW50JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYWNjb3VudCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzaWduaW4nLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zaWduaW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaWduaW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc2lnbnVwJyx7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbnVwJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2FjY291bnQuYm9va2luZ3MnLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9ib29raW5ncycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Jvb2tpbmdzJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2FjY291bnQuZGV0YWlscycse1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2RldGFpbHMnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdkZXRhaWxzJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2FjY291bnQuY2hhbmdlUGFzc3dvcmQnLHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jaGFuZ2VQYXNzd29yZCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NoYW5nZVBhc3N3b3JkJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbWFpbicpXHJcbiAgICB9KVxyXG4gICAgLnJ1bihbJyRyb290U2NvcGUnLCAnJHN0YXRlJywgJyRzdGF0ZVBhcmFtcycsXHJcbiAgICBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAkcm9vdFNjb3BlLiRzdGF0ZSA9ICRzdGF0ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLiRzdGF0ZVBhcmFtcyA9ICRzdGF0ZVBhcmFtcztcclxuICAgIH1dKTtcclxuICAgIC8qXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvbWFpbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zaWdudXAnLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWdudXAnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc2lnbmluJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zaWduaW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvdXNlcmluZm8nLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy91c2VyaW5mbydcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zdWNjZXNzZnVsU2lnbnVwJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9zdWNjZXNzZnVsU2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL29mZmVyJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9vZmZlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jb25maXJtYXRpb24nLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2NvbmZpcm1hdGlvbidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9zdWNjZXNzZnVsQm9va2luZycse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc3VjY2Vzc2Z1bEJvb2tpbmcnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5vdGhlcndpc2UoJy8nKTtcclxuICAgIH0pO1xyXG4qL1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdhY2NDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGdldFVzZXJCb29raW5ncyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UuZ2V0VXNlckJvb2tpbmdzKCkudGhlbihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJCb29raW5ncyA9IG1zZztcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5nZXRVc2VySW5mbygpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpcnN0TmFtZSA9IHVzZXIuZmlyc3ROYW1lO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxhc3ROYW1lID0gdXNlci5sYXN0TmFtZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lbWFpbCA9IHVzZXIuZW1haWw7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGhvbmUgPSB1c2VyLnBob25lO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGdldEluZm8oKTtcclxuICAgICAgICBnZXRVc2VyQm9va2luZ3MoKTtcclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxNC4xMC4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignYXV0aEN0cmwnLCBmdW5jdGlvbiAoJHEsICRzY29wZSwgJHN0YXRlLCAkd2luZG93LCAkbG9jYXRpb24sICRyb3V0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UpIHtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS5yZWdleCA9ICcoXFxcXCtbMC05XVxcXFxkezF9KSooXFxcXHMpKihbMC05XVxcXFxkezJ9KShcXFxccyopKFswLTldXFxcXGR7Mn0pKFxcXFxzKikoWzAtOV1cXFxcZHsyfSknO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuaXNMb2dnZWRJbiA9IGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaWduaW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dpbicpO1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5zaWduaW4oJHNjb3BlLnVzZXIpLnRoZW4oZnVuY3Rpb24gKG1zZywgc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pc0xvZ2VkSW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8kd2luZG93LmxvY2F0aW9uLmhyZWY9JyMvJztcclxuICAgICAgICAgICAgICAgIC8vJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobXNnKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2lnbm91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbm91dCgpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmlzTG9nZWRJbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIC8vc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgICAgICAgICAgLy8kc3RhdGUucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dvdXQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0VXNlckluZm8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldFVzZXJJbmZvKCkudGhlbihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJpbmZvID0gbXNnO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEZvcm0gPSBmdW5jdGlvbiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpZihpc1ZhbGlkKXtcclxuICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ251cCgkc2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQb215xZtsbmllIHphcmVqZXN0cm93YW5vJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbmluKCRzY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChtc2csIHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pc0xvZ2VkSW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkd2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkgPT0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMS8jL2NvbmZpcm1hdGlvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWY9JyMvc3VjY2Vzc2Z1bFNpZ251cCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2goZGF0YS5jb2RlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTAwMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ1d5YnJhbnkgZW1haWwgamVzdCBqdcW8IHphcmVqZXN0cm93YW55LiBQcm9zesSZIHd5YnJhxIcgaW5ueS4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdVcHNzIGNvxZsgcG9zesWCbyBuaWUgdGFrLiBQcm9zesSZIHNwcsOzYm93YcSHIHDDs8W6bmllai4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnVXBzcyBjb8WbIHBvc3rFgm8gbmllIHRhay4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBww7PFum5pZWouJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3N1Ym1pdEVycm9yJywgZnVuY3Rpb24gKGVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvck1lc3NhZ2UpXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxMS4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignY29uZmlybWF0aW9uQ3RybCcsIGZ1bmN0aW9uICgkcSwgJHdpbmRvdywgJGxvY2F0aW9uLCAkc3RhdGUsICRjb29raWVzLCAkc2NvcGUsICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlLCByb29tU2VydmljZSkge1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNTaWduZWRJbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUucm9vbSA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdyb29tJykpO1xyXG4gICAgICAgICRzY29wZS5kYXRlRnJvbSA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKS5kYXRlRnJvbTtcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gSlNPTi5wYXJzZSgkY29va2llcy5nZXQoJ2RhdGVzJykpLmRhdGVUbztcclxuICAgICAgICAkc2NvcGUuZXh0cmFzID0gSlNPTi5wYXJzZSgkY29va2llcy5nZXQoJ2V4dHJhcycpKS5leHRyYXM7XHJcbiAgICAgICAgJHNjb3BlLm51bU9mRGF5cyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdleHRyYXMnKSkubnVtT2ZEYXlzO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkID8gJHNjb3BlLmlzU2lnbmVkSW4gPSB0cnVlIDogJHNjb3BlLmlzU2lnbmVkSW4gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAkc2NvcGUucmVzZXJ2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYoJHNjb3BlLnRlcm1zICE9IHRydWUpXHJcbiAgICAgICAgICAgICAgICBhbGVydCgnUHJ6ZWQgcG90d2llcmR6ZW5pZW0gcmV6ZXJ3YWNqaSBuYWxlxbx5IHphYWtjZXB0b3dhxIdyZWd1bGFtaW4uJyk7XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICByb29tU2VydmljZS5ib29rUm9vbSh7aWQ6ICRzY29wZS5yb29tLl9pZCwgZnJvbTogJHNjb3BlLmRhdGVGcm9tLCB0bzogJHNjb3BlLmRhdGVUbywgcHJpY2U6IGNhbGN1bGF0ZVRvdGFsUHJpY2UoKSwgZXh0cmFzOiAkc2NvcGUuZXh0cmFzfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIy9zdWNjZXNzZnVsQm9va2luZydcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdzdWNjZXNzZnVsQm9va2luZycpXHJcbiAgICAgICAgICAgICAgICB9LGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETyB3ecWbd2lldGxlbmllIGVycnJvcmFcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvUHJldmlvdXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvb2ZmZXInXHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnb2ZmZXInKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjYWxjdWxhdGVUb3RhbFByaWNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwO1xyXG4gICAgICAgICAgICB0b3RhbCA9ICgkc2NvcGUucm9vbS5wcmljZSAqICRzY29wZS5udW1PZkRheXMpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXh0cmFzLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsICs9IGUucHJpY2UgKiAkc2NvcGUubnVtT2ZEYXlzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRvdGFsO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL1RPRE8genJvYmllbmllIHJlamVzdHJhY2ppKG1vxbxlIHByemVuaWVzaWVuaWUgbmEgc2lnbnVwIHZpZXc/IGRvIHJvendhxbxlbmlhKSBpIG9ic8WCdWdhIGLFgsSZZMOzdyhtb8W8ZSBqYWtvxZsgcG/FgsSFY3p5xIcgb2J5ZHdhIGxvZ293YW5pYSBpIHJlamVzdHJhY2plIHcgamVkbm8/KVxyXG4gICAgICAgIC8vVE9ETyBPYnNsdWdhIGJsZWRvdyByZXplcndhY2ppXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgY3plZ29zIGRvIHdpZG9rdSByZXplcndhamNpXHJcbiAgICAgICAgLy9UT0RPIHBvdXPDs3dhxIcgamFraWXFmyBpbml0eSh3eXN0YWN6eSB3eW/FgmHEhyBmdW5rY2rEmSB3IGtvbnRyb2xlcnplIGx1YiBzcnYpXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgY2HFgmVqIG9ic8WCdWdpIGtvbnRhKHptaWFuYSBoYXPFgmEsIG51bWVydSB0ZWxlZm9udVtkb2RhbmllIGx1YiB6bWlhbmFdLCBwb2RnbMSFZHUgcmV6ZXJ3YWNqaSwgaXRwKSBvcmF6IG9ic8WCdWdpIGhvdGVsdShDUlVEIGRvZGF0a8OzdywgcG9rb2ppIGl0cCkuXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgbW/FvGUgamFracWbIHd5a3Jlc8OzdyBuYSB0ZW1hdCBvYmNpxIXFvGVuaWEgcG9rb2ppIGx1YiBqYWtpxZsgcHJ6eWNob2TDs3cgY3p5IGNvxZsgYWxibyBqYWllxZsgY2/FmyBkbyBnZW5lcm93YW5pZSBwZGYgeiByYXBvcnRlbVxyXG4gICAgICAgIC8vVE9ETyBwb3ptaWVuaWHEhyBzxYJvd2EgcmVzZXJ2YXRpb24gaXRwIG5hIGJvb2tpbmdcclxuICAgICAgICAvL1RPRE8ga29keSByYWJhdG93ZVxyXG4gICAgICAgIC8vVE9ETyBwb3dpYWRvbWllbmllIG8gY2lhc3RlY3prYWNoXHJcbiAgICAgICAgLy9UT0RPIGRvZGFuaWUgcG9kZ2zEhWR1IG9ixYJvxbxlbmlhIGhvdGVsdSBqYWsgdyBraW5pKDMgc3Rhbnk6IHdvbG55LCB6YXJlemVyd293YW55LCB6YWpldHkpXHJcbiAgICAgICAgLy9UT0RPIHpiYWRhbmllIGN6eSAucnVuIHN0YXRlUHJvdmlkZXJhIHBvY3plYm5lXHJcbiAgICAgICAgLy9UT0RPIHBvem5hbmllIHN0YXRlUHJvdmlkZXJhIGkgZG9kYW5pZSBuZXN0ZWQgdmlld3NcclxuICAgICAgICAvL1RPRE8gbmEgZ8WCw7N3bmVqIHN0cm9uaWUgenJvYmnEh8W8ZWJ5IGRhdGEgYnnFgsSFIGNvbmFqbW5pZWogamVkZW4gZHppZW4gcmV6ZXJ3YWNqaVxyXG4gICAgICAgIC8vVE9ETyBrb250b1xyXG4gICAgICAgIC8vem1pYW5hIGRhbnljaFxyXG4gICAgICAgIC8vem1pYW5hIGhhc8WCYVxyXG4gICAgICAgIC8vem9iYWN6ZW5pZSByZXplcndhY2ppXHJcbiAgICAgICAgLy9hbnVsb3dhbmllIHJlemVyd2FjamlcclxuICAgICAgICAvL1xyXG4gICAgICAgIGluaXQoKTtcclxuXHJcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ2NvbXBhcmVUbycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiBcIm5nTW9kZWxcIixcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIG90aGVyTW9kZWxWYWx1ZTogXCI9Y29tcGFyZVRvXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmNvbXBhcmVUbyA9IGZ1bmN0aW9uKG1vZGVsVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWxWYWx1ZSA9PSBzY29wZS5vdGhlck1vZGVsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIm90aGVyTW9kZWxWYWx1ZVwiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSlcclxuICAgIC5kaXJlY3RpdmUoJ3VzZXJJbmZvJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8cD5zaWFsYWxhPC9wPidcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA4LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdvZmZlckN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkY29va2llcywgJHN0YXRlLCAkbG9jYXRpb24sICR3aW5kb3csIG9mZmVyU3ZjKSB7XHJcbiAgICAgICAgJHNjb3BlLm9mZmVyID0ge307XHJcbiAgICAgICAgJHNjb3BlLmV4dHJhcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcyA9IFtdO1xyXG4gICAgICAgIHZhciBkYXRlcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5kYXRlRnJvbSA9ICcnO1xyXG4gICAgICAgICRzY29wZS5kYXRlVG8gPSAnJztcclxuICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAnJztcclxuXHJcblxyXG4gICAgICAgIHZhciBzaG93T2ZmZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5vZmZlciA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdyb29tJykpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZ2V0RXh0cmFzKCk7XHJcblxyXG4gICAgICAgICAgICBkYXRlcyA9IEpTT04ucGFyc2UoJGNvb2tpZXMuZ2V0KCdkYXRlcycpKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZVByZWV0aWZ5KG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlVG8gPSBkYXRlUHJlZXRpZnkobmV3IERhdGUoZGF0ZXMuZGF0ZVRvKSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucm9vbU5hbWUgPSAkc2NvcGUub2ZmZXIudHlwZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21QcmljZSA9ICRzY29wZS5vZmZlci5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgPSAwO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGF0ZVByZWV0aWZ5ID0gZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGRheSA9IGRhdGUuZ2V0VVRDRGF0ZSgpO1xyXG4gICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxO1xyXG4gICAgICAgICAgICB2YXIgeWVhciA9IGRhdGUuZ2V0VVRDRnVsbFllYXIoKTtcclxuICAgICAgICAgICAgcmV0dXJuICcnK2RheSsnLScrbW9udGgrJy0nK3llYXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZE9yUmVtb3ZlRXh0cmEgPSBmdW5jdGlvbiAoZXh0cmEpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9ICRzY29wZS5zZWxlY3RlZEV4dHJhcy5pbmRleE9mKGV4dHJhKTtcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVGV4dCA9IGV4dHJhLmJ1dHRvblRvZ2dsZSA/ICdEb2RhaiArJyA6ICdVc3XFhCAtJztcclxuICAgICAgICAgICAgZXh0cmEuYnV0dG9uVG9nZ2xlID0gIWV4dHJhLmJ1dHRvblRvZ2dsZTtcclxuXHJcbiAgICAgICAgICAgIGlmKGluZGV4ID09IC0xKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEV4dHJhcy5wdXNoKGV4dHJhKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlICs9IChleHRyYS5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMuc3BsaWNlKGluZGV4LDEpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1RvdGFsUHJpY2UgLT0gKGV4dHJhLnByaWNlICogY2FsY3VsYXRlRGlmZk9mRGF5cygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS50b0NvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FzZGFzZCcpO1xyXG4gICAgICAgICAgICB2YXIgZXh0cmFzID0ge2V4dHJhczogJHNjb3BlLnNlbGVjdGVkRXh0cmFzLCBudW1PZkRheXM6IGNhbGN1bGF0ZURpZmZPZkRheXMoKX07XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZXh0cmFzJywgSlNPTi5zdHJpbmdpZnkoZXh0cmFzKSk7XHJcbiAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvY29uZmlybWF0aW9uJ1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2NvbmZpcm1hdGlvbicpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvUHJldmlvdXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvbWFpbidcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJylcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0cmFzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5nZXRFeHRyYXMoKS50aGVuKGZ1bmN0aW9uIChleHRyYXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzID0gZXh0cmFzRGF0YTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgJHNjb3BlLmV4dHJhcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1tpXS5idXR0b25UZXh0ID0gJ0RvZGFqICsnO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNbaV0uYnV0dG9uVG9nZ2xlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjYWxjdWxhdGVEaWZmT2ZEYXlzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgTVNfUEVSX0RBWSA9IDEwMDAgKiA2MCAqIDYwICogMjQ7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IG5ldyBEYXRlKGRhdGVzLmRhdGVGcm9tKTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUbyA9IG5ldyBEYXRlKGRhdGVzLmRhdGVUbyk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbVVUQyA9IERhdGUuVVRDKGRhdGVGcm9tLmdldEZ1bGxZZWFyKCksIGRhdGVGcm9tLmdldE1vbnRoKCksIGRhdGVGcm9tLmdldERhdGUoKSk7XHJcbiAgICAgICAgICAgIHZhciBkYXRlVG9VVEMgPSBEYXRlLlVUQyhkYXRlVG8uZ2V0RnVsbFllYXIoKSwgZGF0ZVRvLmdldE1vbnRoKCksIGRhdGVUby5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZVRvVVRDIC0gZGF0ZUZyb21VVEMpIC8gTVNfUEVSX0RBWSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2hvd09mZmVyKCk7XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDYuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3Jvb21DdHJsJywgZnVuY3Rpb24gKCRxLCAkY29va2llcywgJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIHJvb21TZXJ2aWNlLCBvZmZlclN2YywkZmlsdGVyLCAkc3RhdGUpIHtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSAnJztcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLm5vUm9vbXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5lcnJvck1zZyA9Jyc7XHJcbiAgICAgICAgJHNjb3BlLnJvb21zID0gW107XHJcbiAgICAgICAgJHNjb3BlLm51bWJlck9mQmVkcyA9IDE7XHJcblxyXG5cclxuICAgICAgICB2YXIgc2V0RGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRlKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUZW1wID0gbmV3IERhdGU7XHJcbiAgICAgICAgICAgIGRhdGVUZW1wLnNldERhdGUoZGF0ZVRlbXAuZ2V0RGF0ZSgpKzEpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZVRvID0gZGF0ZVRlbXA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNldERhdGUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5maW5kUm9vbXMgPSBmdW5jdGlvbiAoKSB7Ly9UT0RPIFd5xZt3aWV0bGVuaWUgZXJyb3JhIG8gYnJha3UgcG9rb2ppIG8gd3licmFueWNoIHBhcmFtZXRyYWNoIHXFvHl3YWrEhWMgbm9Sb29tc0Vycm9yIGkgbmctSGlkZVxyXG4gICAgICAgICAgICByb29tU2VydmljZS5nZXRSb29tcyh7XHJcbiAgICAgICAgICAgICAgICBmcm9tOiAkc2NvcGUuZGF0ZUZyb20udG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHRvOiAkc2NvcGUuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICBiZWRzOiAkc2NvcGUubnVtYmVyT2ZCZWRzXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJvb21zRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJvb21zID0gcm9vbXNEYXRhO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5ub1Jvb21zRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTXNnID0gJ0NvxZsgcG9zesWCbyBuaWUgdGFrLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZFJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ3Jvb20nLCBKU09OLnN0cmluZ2lmeShyb29tKSk7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZGF0ZXMnLCBKU09OLnN0cmluZ2lmeSh7ZGF0ZUZyb206ICRzY29wZS5kYXRlRnJvbSwgZGF0ZVRvOiAkc2NvcGUuZGF0ZVRvfSkpO1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5jaG9vc2VSb29tKHJvb20pO1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ29mZmVyJyk7XHJcbiAgICAgICAgICAgIC8vJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL29mZmVyJztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJvb21zKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMDcuMTEuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZpbHRlcigndW5pcXVlQ2F0ZWdvcmllcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJvb21zLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0FycmF5KHJvb21zKSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHJvb21zLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gcm9vbXNbaV1bcHJvcGVydHlOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQoa2V5c1t2YWxdKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXNbdmFsXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJvb21zW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvb21zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDE0LjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHEnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XHJcbiAgICAgICAgdmFyIExPQ0FMX1RPS0VOID0gJ3Rva2VuJztcclxuICAgICAgICB2YXIgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGF1dGhUb2tlbjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZFVzZXJJbmZvKCkge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oTE9DQUxfVE9LRU4pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9hZGluZyBVc2VyIGluZm8uLi4nKTsvL0RvIHVzdW5pxJljaWFcclxuICAgICAgICAgICAgaWYodG9rZW4pXHJcbiAgICAgICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZXN0cm95VXNlckluZm8oKSB7XHJcbiAgICAgICAgICAgIGF1dGhUb2tlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMT0NBTF9UT0tFTik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdG9yZVVzZXJJbmZvKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShMT0NBTF9UT0tFTiwgdG9rZW4pO1xyXG4gICAgICAgICAgICB1c2VySW5mbyh0b2tlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1c2VySW5mbyh0b2tlbikge1xyXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBhdXRoVG9rZW4gPSB0b2tlbjtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IGF1dGhUb2tlbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzaWduaW4gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9hdXRoZW50aWNhdGUnLCB1c2VyKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmVVc2VySW5mbyhyZXN1bHQuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnLCByZXN1bHQuZGF0YS5zdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICB2YXIgc2lnbm91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVzdHJveVVzZXJJbmZvKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNpZ251cCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3NpZ251cCcsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnamVzdGVtIHcgcmVzb2x2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsb2FkVXNlckluZm8oKTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3VzZXJpbmZvJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoe2ZpcnN0TmFtZTogcmVzdWx0LmRhdGEuZmlyc3ROYW1lLCBsYXN0TmFtZTogcmVzdWx0LmRhdGEubGFzdE5hbWUsIGVtYWlsOiByZXN1bHQuZGF0YS5lbWFpbCwgcGhvbmU6IHJlc3VsdC5kYXRhLnBob25lfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckJvb2tpbmdzID0gZnVuY3Rpb24gKCkgey8vVE9ETyBwb3ByYXdpxIcgcmF6ZW0geiBhcGkgxbxlYnkgZGF3YcWCbyBzdWNjZXNzXHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvZ2V0VXNlckJvb2tpbmdzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBzaWduaW46IHNpZ25pbixcclxuICAgICAgICAgICAgc2lnbm91dDogc2lnbm91dCxcclxuICAgICAgICAgICAgc2lnbnVwOiBzaWdudXAsXHJcbiAgICAgICAgICAgIGdldFVzZXJJbmZvOiBnZXRVc2VySW5mbyxcclxuICAgICAgICAgICAgZ2V0VXNlckJvb2tpbmdzOiBnZXRVc2VyQm9va2luZ3MsXHJcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogaXNBdXRoZW50aWNhdGVkXHJcbiAgICAgICAgfVxyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwOC4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnb2ZmZXJTdmMnLCBmdW5jdGlvbiAoJHEsICRodHRwKSB7XHJcbiAgICAgICAgdmFyIGNob3NlblJvb20gPSB7fTtcclxuICAgICAgICB2YXIgZXh0cmFzID0gW107XHJcblxyXG4gICAgICAgIHZhciBjaG9vc2VSb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuICAgICAgICAgICAgY2hvb3NlblJvb20gPSByb29tO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRSb29tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hvb3NlblJvb207XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dHJhcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9nZXRFeHRyYXMnKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5leHRyYXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgY2hvb3NlUm9vbTogY2hvb3NlUm9vbSxcclxuICAgICAgICAgICAgZ2V0Um9vbTogZ2V0Um9vbSxcclxuICAgICAgICAgICAgZ2V0RXh0cmFzOiBnZXRFeHRyYXMsXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwNi4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgncm9vbVNlcnZpY2UnLCBmdW5jdGlvbiAoJHEsICRodHRwKSB7XHJcblxyXG4gICAgICAgIHZhciBnZXRSb29tcyA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2ZpbmRSb29tcycsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9icmFubyBwb2tvamUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5yb29tcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBib29rUm9vbSA9IGZ1bmN0aW9uIChkYXRhKSB7Ly9UT0RPIHpqYcSFxIcgc2nEmVxyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9yZXNlcnZlJywgZGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEuc3VjY2VzcylcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEuZXJyb3IpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldFJvb21zOiBnZXRSb29tcyxcclxuICAgICAgICAgICAgYm9va1Jvb206IGJvb2tSb29tXHJcbiAgICAgICAgfVxyXG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
