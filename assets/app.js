var app=angular.module("app",["ngRoute","ui.router","ngCookies"]);angular.module("app").factory("authInterceptor",["$window",function(o){return{request:function(e){return e.headers=e.headers||{},o.localStorage.token&&(e.headers.Authorization=o.localStorage.token),e}}}]).config(["$routeProvider","$httpProvider",function(o,e){e.interceptors.push("authInterceptor"),o.when("/",{templateUrl:"/main"}).when("/signup",{templateUrl:"/signup"}).when("/signin",{templateUrl:"/signin"}).when("/userinfo",{templateUrl:"/userinfo"}).when("/successfulSignup",{templateUrl:"/successfulSignup"}).when("/offer",{templateUrl:"/offer"}).when("/confirmation",{templateUrl:"/confirmation"}).otherwise("/")}]),angular.module("app").controller("authCtrl",["$q","$scope","$window","$location","$route","$rootScope","AuthService",function(o,e,t,n,r,a,i){e.regex="(\\+[0-9]\\d{1})*(\\s)*([0-9]\\d{2})(\\s*)([0-9]\\d{2})(\\s*)([0-9]\\d{2})",e.submitError=!1,e.errorMessage="",a.isLoggedIn=function(){return i.isAuthenticated},e.signin=function(){console.log("login"),i.signin(e.user).then(function(o,e){a.isLogedIn=!0,t.location.href="#/",t.location.reload(),console.log(o)})},e.signout=function(){i.signout(),a.isLogedIn=!1,t.location.reload(),console.log("logout")},e.getUserInfo=function(){i.getUserInfo().then(function(o){console.log(o),e.userinfo=o})},e.submitForm=function(o){o?i.signup(e.user).then(function(o){console.log("Pomyślnie zarejestrowano"),e.submitError=!1,t.location.href="#/successfulSignup"},function(o){switch(console.log(o),o.code){case 11e3:e.submitError=!0,e.errorMessage="Wybrany email jest już zarejestrowany. Proszę wybrać inny.";break;default:e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później."}}):(e.submitError=!0,e.errorMessage="Upss coś poszło nie tak. Proszę spróbować później.")},e.$watch("submitError",function(o){console.log(o)})}]),angular.module("app").controller("confirmationCtrl",["$q","$window","$location","$cookies","$scope","$rootScope","AuthService",function(o,e,t,n,r,a,i){r.isSignedIn=!1;var s=function(){i.isAuthenticated?r.isSignedIn=!0:r.isSignedIn=!1};r.signin=function(){i.signin(r.user).then(function(o,t){a.isLogedIn=!0,r.isSignedIn=!0,e.location.reload(),console.log("wohohoho")},function(o){console.log("błędny login lub hasło")})},s()}]),angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(o,e,t,n){n.$validators.compareTo=function(e){return e==o.otherModelValue},o.$watch("otherModelValue",function(){n.$validate()})}}}),angular.module("app").controller("offerCtrl",["$scope","$cookies","$location","$window","offerSvc",function(o,e,t,n,r){o.offer={},o.extras=[],o.selectedExtras=[];var a={};o.dateFrom="",o.dateTo="",o.roomName="";var i=function(){o.offer=JSON.parse(e.get("room")),o.extras=u(),a=JSON.parse(e.get("dates")),o.dateFrom=s(new Date(a.dateFrom)),o.dateTo=s(new Date(a.dateTo)),o.roomName=o.offer.type,o.roomPrice=o.offer.price,o.extrasTotalPrice=0},s=function(o){var e=o.getUTCDate(),t=o.getUTCMonth()+1,n=o.getUTCFullYear();return""+e+"-"+t+"-"+n};o.addOrRemoveExtra=function(e){var t=o.selectedExtras.indexOf(e);e.buttonText=e.buttonToggle?"Dodaj +":"Usuń -",e.buttonToggle=!e.buttonToggle,t==-1?(o.selectedExtras.push(e),o.extrasTotalPrice+=e.price*c()):(o.selectedExtras.splice(t,1),o.extrasTotalPrice-=e.price*c())},o.toConfirmation=function(){console.log("asdasd"),n.location.href="#/confirmation"},o.toPrevious=function(){n.location.href="#/main"};var u=function(){r.getExtras().then(function(e){o.extras=e;for(var t=0;t<o.extras.length;t++)o.extras[t].buttonText="Dodaj +",o.extras[t].buttonToggle=!1})},c=function(){var o=864e5,e=new Date(a.dateFrom),t=new Date(a.dateTo),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((r-n)/o)};i()}]),angular.module("app").controller("roomCtrl",["$q","$cookies","$scope","$window","$location","roomService","offerSvc","$filter",function(o,e,t,n,r,a,i,s){t.dateFrom="",t.dateTo="",t.noRoomsError=!1,t.errorMsg="",t.rooms=[],t.numberOfBeds=1;var u=function(){var o=new Date;console.log(o),t.dateFrom=o;var e=new Date;e.setDate(e.getDate()+1),t.dateTo=e};t.init=function(){u(),t.findRooms()},t.findRooms=function(){a.getRooms({from:t.dateFrom.toISOString(),to:t.dateTo.toISOString(),beds:t.numberOfBeds}).then(function(o){t.rooms=o},function(o){t.noRoomsError=!0,t.errorMsg="Coś poszło nie tak."})},t.addRoom=function(o){e.put("room",JSON.stringify(o)),e.put("dates",JSON.stringify({dateFrom:t.dateFrom,dateTo:t.dateTo})),i.chooseRoom(o),n.location.href="#/offer"},t.test=function(){console.log(t.rooms),t.findRooms()}}]),angular.module("app").filter("uniqueCategories",function(){return function(o,e){if(angular.isArray(o)){for(var t=[],n={},r=0;r<o.length;r++){var a=o[r][e];angular.isUndefined(n[a])&&(n[a]=!0,t.push(o[r]))}return t}return o}}),angular.module("app").service("AuthService",["$http","$q",function(o,e){function t(){var o=window.localStorage.getItem(s);console.log("loading User info..."),o&&a(o)}function n(){i=void 0,u=!1,o.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(s)}function r(o){window.localStorage.setItem(s,o),a(o)}function a(e){u=!0,i=e,o.defaults.headers.common.Authorization=i}var i,s="token",u=!1,c=function(t){return e(function(e,n){o.post("/api/authenticate",t).then(function(o){o.data.success?(r(o.data.token),e(o.data.msg,o.data.success)):n(o.data.msg,o.data.success)})})},l=function(){n()},f=function(t){return e(function(e,n){o.post("/api/signup",t).then(function(o){o.data.success?(console.log("jestem w resolve"),e(o.data.msg)):n(o.data.msg)})})};t();var g=function(){return e(function(e,t){o.get("/api/userinfo").then(function(o){o.data.success?e(o.data.msg):t(o.data.msg)})})};return{signin:c,signout:l,signup:f,getUserInfo:g,isAuthenticated:u}}]),angular.module("app").service("offerSvc",["$q","$http",function(o,e){var t=function(o){choosenRoom=o},n=function(){return choosenRoom},r=function(){return o(function(o,t){e.get("/api/getExtras").then(function(e){e.data.success?o(e.data.extras):t(e.data.error)})})};return{chooseRoom:t,getRoom:n,getExtras:r}}]),angular.module("app").service("roomService",["$q","$http",function(o,e){var t=function(t){return o(function(o,n){e.post("/api/findRooms",t).then(function(e){e.data.success?(console.log("Pobrano pokoje"),o(e.data.rooms)):n(e.data.error)})})};return{getRooms:t}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbmZpZy5qcyIsImNvbnRyb2xsZXJzL2F1dGhvcml6YXRpb24uanMiLCJjb250cm9sbGVycy9jb25maXJtYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvZGlyZWN0aXZlcy5qcyIsImNvbnRyb2xsZXJzL29mZmVyQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3Jvb21Db250cm9sbGVyLmpzIiwiZmlsbHRlcnMvcm9vbUZpbHRlci5qcyIsInNlcnZpY2VzL2F1dGhvcml6YXRpb24uc3ZjLmpzIiwic2VydmljZXMvb2ZmZXIuc3ZjLmpzIiwic2VydmljZXMvcm9vbS5zdmMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImZhY3RvcnkiLCIkd2luZG93IiwicmVxdWVzdCIsImNvbmZpZyIsImhlYWRlcnMiLCJsb2NhbFN0b3JhZ2UiLCJ0b2tlbiIsIiRyb3V0ZVByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJjb250cm9sbGVyIiwiJHEiLCIkc2NvcGUiLCIkbG9jYXRpb24iLCIkcm91dGUiLCIkcm9vdFNjb3BlIiwiQXV0aFNlcnZpY2UiLCJyZWdleCIsInN1Ym1pdEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaXNMb2dnZWRJbiIsImlzQXV0aGVudGljYXRlZCIsInNpZ25pbiIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyIiwidGhlbiIsIm1zZyIsInN1Y2Nlc3MiLCJpc0xvZ2VkSW4iLCJsb2NhdGlvbiIsImhyZWYiLCJyZWxvYWQiLCJzaWdub3V0IiwiZ2V0VXNlckluZm8iLCJ1c2VyaW5mbyIsInN1Ym1pdEZvcm0iLCJpc1ZhbGlkIiwic2lnbnVwIiwiZGF0YSIsImNvZGUiLCIkd2F0Y2giLCIkY29va2llcyIsImlzU2lnbmVkSW4iLCJpbml0IiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJNb2RlbFZhbHVlIiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dGVzIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiY29tcGFyZVRvIiwibW9kZWxWYWx1ZSIsIiR2YWxpZGF0ZSIsIm9mZmVyU3ZjIiwib2ZmZXIiLCJleHRyYXMiLCJzZWxlY3RlZEV4dHJhcyIsImRhdGVzIiwiZGF0ZUZyb20iLCJkYXRlVG8iLCJyb29tTmFtZSIsInNob3dPZmZlciIsIkpTT04iLCJwYXJzZSIsImdldCIsImdldEV4dHJhcyIsImRhdGVQcmVldGlmeSIsIkRhdGUiLCJ0eXBlIiwicm9vbVByaWNlIiwicHJpY2UiLCJleHRyYXNUb3RhbFByaWNlIiwiZGF0ZSIsImRheSIsImdldFVUQ0RhdGUiLCJtb250aCIsImdldFVUQ01vbnRoIiwieWVhciIsImdldFVUQ0Z1bGxZZWFyIiwiYWRkT3JSZW1vdmVFeHRyYSIsImV4dHJhIiwiaW5kZXgiLCJpbmRleE9mIiwiYnV0dG9uVGV4dCIsImJ1dHRvblRvZ2dsZSIsImNhbGN1bGF0ZURpZmZPZkRheXMiLCJzcGxpY2UiLCJ0b0NvbmZpcm1hdGlvbiIsInRvUHJldmlvdXMiLCJleHRyYXNEYXRhIiwiaSIsImxlbmd0aCIsIk1TX1BFUl9EQVkiLCJkYXRlRnJvbVVUQyIsIlVUQyIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZGF0ZVRvVVRDIiwiTWF0aCIsImZsb29yIiwicm9vbVNlcnZpY2UiLCIkZmlsdGVyIiwibm9Sb29tc0Vycm9yIiwiZXJyb3JNc2ciLCJyb29tcyIsIm51bWJlck9mQmVkcyIsInNldERhdGUiLCJkYXRlVGVtcCIsImZpbmRSb29tcyIsImdldFJvb21zIiwiZnJvbSIsInRvSVNPU3RyaW5nIiwidG8iLCJiZWRzIiwicm9vbXNEYXRhIiwiZXJyb3IiLCJhZGRSb29tIiwicm9vbSIsInB1dCIsInN0cmluZ2lmeSIsImNob29zZVJvb20iLCJ0ZXN0IiwiZmlsdGVyIiwicHJvcGVydHlOYW1lIiwiaXNBcnJheSIsInJlc3VsdCIsImtleXMiLCJ2YWwiLCJpc1VuZGVmaW5lZCIsInNlcnZpY2UiLCIkaHR0cCIsImxvYWRVc2VySW5mbyIsIndpbmRvdyIsImdldEl0ZW0iLCJMT0NBTF9UT0tFTiIsInVzZXJJbmZvIiwiZGVzdHJveVVzZXJJbmZvIiwiYXV0aFRva2VuIiwidW5kZWZpbmVkIiwiZGVmYXVsdHMiLCJjb21tb24iLCJyZW1vdmVJdGVtIiwic3RvcmVVc2VySW5mbyIsInNldEl0ZW0iLCJyZXNvbHZlIiwicmVqZWN0IiwicG9zdCIsImNob29zZW5Sb29tIiwiZ2V0Um9vbSJdLCJtYXBwaW5ncyI6IkFBR0EsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxPQUFBLFVBQUEsWUFBQSxhQ0FBRCxTQUFBQyxPQUFBLE9BQ0FDLFFBQUEsbUJBQUEsVUFBQSxTQUFBQyxHQUNBLE9BQ0FDLFFBQUEsU0FBQUMsR0FNQSxNQUxBQSxHQUFBQyxRQUFBRCxFQUFBQyxZQUNBSCxFQUFBSSxhQUFBQyxRQUNBSCxFQUFBQyxRQUFBLGNBQUFILEVBQUFJLGFBQUFDLE9BR0FILE9BS0FBLFFBQUEsaUJBQUEsZ0JBQUEsU0FBQUksRUFBQUMsR0FDQUEsRUFBQUMsYUFBQUMsS0FBQSxtQkFDQUgsRUFDQUksS0FBQSxLQUNBQyxZQUFBLFVBRUFELEtBQUEsV0FDQUMsWUFBQSxZQUVBRCxLQUFBLFdBQ0FDLFlBQUEsWUFFQUQsS0FBQSxhQUNBQyxZQUFBLGNBRUFELEtBQUEscUJBQ0FDLFlBQUEsc0JBRUFELEtBQUEsVUFDQUMsWUFBQSxXQUVBRCxLQUFBLGlCQUNBQyxZQUFBLGtCQUVBQyxVQUFBLFFDdENBZixRQUFBQyxPQUFBLE9BQ0FlLFdBQUEsWUFBQSxLQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUEsYUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFmLEVBQUFnQixFQUFBQyxFQUFBQyxFQUFBQyxHQUdBSixFQUFBSyxNQUFBLDZFQUVBTCxFQUFBTSxhQUFBLEVBQ0FOLEVBQUFPLGFBQUEsR0FFQUosRUFBQUssV0FBQSxXQUNBLE1BQUFKLEdBQUFLLGlCQUdBVCxFQUFBVSxPQUFBLFdBQ0FDLFFBQUFDLElBQUEsU0FDQVIsRUFBQU0sT0FBQVYsRUFBQWEsTUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxHQUNBYixFQUFBYyxXQUFBLEVBQ0FoQyxFQUFBaUMsU0FBQUMsS0FBQSxLQUNBbEMsRUFBQWlDLFNBQUFFLFNBQ0FULFFBQUFDLElBQUFHLE1BSUFmLEVBQUFxQixRQUFBLFdBQ0FqQixFQUFBaUIsVUFDQWxCLEVBQUFjLFdBQUEsRUFDQWhDLEVBQUFpQyxTQUFBRSxTQUNBVCxRQUFBQyxJQUFBLFdBR0FaLEVBQUFzQixZQUFBLFdBQ0FsQixFQUFBa0IsY0FBQVIsS0FBQSxTQUFBQyxHQUNBSixRQUFBQyxJQUFBRyxHQUNBZixFQUFBdUIsU0FBQVIsS0FJQWYsRUFBQXdCLFdBQUEsU0FBQUMsR0FDQUEsRUFDQXJCLEVBQUFzQixPQUFBMUIsRUFBQWEsTUFBQUMsS0FBQSxTQUFBYSxHQUNBaEIsUUFBQUMsSUFBQSw0QkFDQVosRUFBQU0sYUFBQSxFQUNBckIsRUFBQWlDLFNBQUFDLEtBQUEsc0JBQ0EsU0FBQVEsR0FHQSxPQUZBaEIsUUFBQUMsSUFBQWUsR0FFQUEsRUFBQUMsTUFDQSxJQUFBLE1BQ0E1QixFQUFBTSxhQUFBLEVBQ0FOLEVBQUFPLGFBQUEsNERBQ0EsTUFDQSxTQUNBUCxFQUFBTSxhQUFBLEVBQ0FOLEVBQUFPLGFBQUEseURBSUFQLEVBQUFNLGFBQUEsRUFDQU4sRUFBQU8sYUFBQSx1REFJQVAsRUFBQTZCLE9BQUEsY0FBQSxTQUFBdEIsR0FDQUksUUFBQUMsSUFBQUwsUUMvREF6QixRQUFBQyxPQUFBLE9BQ0FlLFdBQUEsb0JBQUEsS0FBQSxVQUFBLFlBQUEsV0FBQSxTQUFBLGFBQUEsY0FBQSxTQUFBQyxFQUFBZCxFQUFBZ0IsRUFBQTZCLEVBQUE5QixFQUFBRyxFQUFBQyxHQUVBSixFQUFBK0IsWUFBQSxDQUVBLElBQUFDLEdBQUEsV0FDQTVCLEVBQUFLLGdCQUFBVCxFQUFBK0IsWUFBQSxFQUFBL0IsRUFBQStCLFlBQUEsRUFJQS9CLEdBQUFVLE9BQUEsV0FDQU4sRUFBQU0sT0FBQVYsRUFBQWEsTUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxHQUNBYixFQUFBYyxXQUFBLEVBQ0FqQixFQUFBK0IsWUFBQSxFQUNBOUMsRUFBQWlDLFNBQUFFLFNBQ0FULFFBQUFDLElBQUEsYUFDQSxTQUFBRyxHQUNBSixRQUFBQyxJQUFBLDZCQU1Bb0IsT0MxQkFsRCxRQUFBQyxPQUFBLE9BQ0FrRCxVQUFBLFlBQUEsV0FDQSxPQUNBQyxRQUFBLFVBQ0FDLE9BQ0FDLGdCQUFBLGNBRUFDLEtBQUEsU0FBQUYsRUFBQUcsRUFBQUMsRUFBQUMsR0FFQUEsRUFBQUMsWUFBQUMsVUFBQSxTQUFBQyxHQUNBLE1BQUFBLElBQUFSLEVBQUFDLGlCQUdBRCxFQUFBTixPQUFBLGtCQUFBLFdBQ0FXLEVBQUFJLGtCQ1hBOUQsUUFBQUMsT0FBQSxPQUNBZSxXQUFBLGFBQUEsU0FBQSxXQUFBLFlBQUEsVUFBQSxXQUFBLFNBQUFFLEVBQUE4QixFQUFBN0IsRUFBQWhCLEVBQUE0RCxHQUNBN0MsRUFBQThDLFNBQ0E5QyxFQUFBK0MsVUFDQS9DLEVBQUFnRCxpQkFDQSxJQUFBQyxLQUNBakQsR0FBQWtELFNBQUEsR0FDQWxELEVBQUFtRCxPQUFBLEdBQ0FuRCxFQUFBb0QsU0FBQSxFQUdBLElBQUFDLEdBQUEsV0FDQXJELEVBQUE4QyxNQUFBUSxLQUFBQyxNQUFBekIsRUFBQTBCLElBQUEsU0FDQXhELEVBQUErQyxPQUFBVSxJQUVBUixFQUFBSyxLQUFBQyxNQUFBekIsRUFBQTBCLElBQUEsVUFDQXhELEVBQUFrRCxTQUFBUSxFQUFBLEdBQUFDLE1BQUFWLEVBQUFDLFdBQ0FsRCxFQUFBbUQsT0FBQU8sRUFBQSxHQUFBQyxNQUFBVixFQUFBRSxTQUVBbkQsRUFBQW9ELFNBQUFwRCxFQUFBOEMsTUFBQWMsS0FDQTVELEVBQUE2RCxVQUFBN0QsRUFBQThDLE1BQUFnQixNQUNBOUQsRUFBQStELGlCQUFBLEdBSUFMLEVBQUEsU0FBQU0sR0FDQSxHQUFBQyxHQUFBRCxFQUFBRSxhQUNBQyxFQUFBSCxFQUFBSSxjQUFBLEVBQ0FDLEVBQUFMLEVBQUFNLGdCQUNBLE9BQUEsR0FBQUwsRUFBQSxJQUFBRSxFQUFBLElBQUFFLEVBR0FyRSxHQUFBdUUsaUJBQUEsU0FBQUMsR0FFQSxHQUFBQyxHQUFBekUsRUFBQWdELGVBQUEwQixRQUFBRixFQUNBQSxHQUFBRyxXQUFBSCxFQUFBSSxhQUFBLFVBQUEsU0FDQUosRUFBQUksY0FBQUosRUFBQUksYUFFQUgsSUFBQSxHQUNBekUsRUFBQWdELGVBQUF0RCxLQUFBOEUsR0FDQXhFLEVBQUErRCxrQkFBQVMsRUFBQVYsTUFBQWUsTUFFQTdFLEVBQUFnRCxlQUFBOEIsT0FBQUwsRUFBQSxHQUNBekUsRUFBQStELGtCQUFBUyxFQUFBVixNQUFBZSxNQUlBN0UsRUFBQStFLGVBQUEsV0FDQXBFLFFBQUFDLElBQUEsVUFDQTNCLEVBQUFpQyxTQUFBQyxLQUFBLGtCQUdBbkIsRUFBQWdGLFdBQUEsV0FDQS9GLEVBQUFpQyxTQUFBQyxLQUFBLFNBR0EsSUFBQXNDLEdBQUEsV0FDQVosRUFBQVksWUFBQTNDLEtBQUEsU0FBQW1FLEdBQ0FqRixFQUFBK0MsT0FBQWtDLENBQ0EsS0FBQSxHQUFBQyxHQUFBLEVBQUFBLEVBQUFsRixFQUFBK0MsT0FBQW9DLE9BQUFELElBQ0FsRixFQUFBK0MsT0FBQW1DLEdBQUFQLFdBQUEsVUFDQTNFLEVBQUErQyxPQUFBbUMsR0FBQU4sY0FBQSxLQUtBQyxFQUFBLFdBQ0EsR0FBQU8sR0FBQSxNQUNBbEMsRUFBQSxHQUFBUyxNQUFBVixFQUFBQyxVQUNBQyxFQUFBLEdBQUFRLE1BQUFWLEVBQUFFLFFBQ0FrQyxFQUFBMUIsS0FBQTJCLElBQUFwQyxFQUFBcUMsY0FBQXJDLEVBQUFzQyxXQUFBdEMsRUFBQXVDLFdBQ0FDLEVBQUEvQixLQUFBMkIsSUFBQW5DLEVBQUFvQyxjQUFBcEMsRUFBQXFDLFdBQUFyQyxFQUFBc0MsVUFDQSxPQUFBRSxNQUFBQyxPQUFBRixFQUFBTCxHQUFBRCxHQUdBL0IsUUMzRUF2RSxRQUFBQyxPQUFBLE9BQ0FlLFdBQUEsWUFBQSxLQUFBLFdBQUEsU0FBQSxVQUFBLFlBQUEsY0FBQSxXQUFBLFVBQUEsU0FBQUMsRUFBQStCLEVBQUE5QixFQUFBZixFQUFBZ0IsRUFBQTRGLEVBQUFoRCxFQUFBaUQsR0FDQTlGLEVBQUFrRCxTQUFBLEdBQ0FsRCxFQUFBbUQsT0FBQSxHQUNBbkQsRUFBQStGLGNBQUEsRUFDQS9GLEVBQUFnRyxTQUFBLEdBQ0FoRyxFQUFBaUcsU0FDQWpHLEVBQUFrRyxhQUFBLENBR0EsSUFBQUMsR0FBQSxXQUNBLEdBQUFuQyxHQUFBLEdBQUFMLEtBQ0FoRCxTQUFBQyxJQUFBb0QsR0FDQWhFLEVBQUFrRCxTQUFBYyxDQUNBLElBQUFvQyxHQUFBLEdBQUF6QyxLQUNBeUMsR0FBQUQsUUFBQUMsRUFBQVgsVUFBQSxHQUNBekYsRUFBQW1ELE9BQUFpRCxFQUdBcEcsR0FBQWdDLEtBQUEsV0FDQW1FLElBQ0FuRyxFQUFBcUcsYUFHQXJHLEVBQUFxRyxVQUFBLFdBQ0FSLEVBQUFTLFVBQ0FDLEtBQUF2RyxFQUFBa0QsU0FBQXNELGNBQ0FDLEdBQUF6RyxFQUFBbUQsT0FBQXFELGNBQ0FFLEtBQUExRyxFQUFBa0csZUFDQXBGLEtBQUEsU0FBQTZGLEdBQ0EzRyxFQUFBaUcsTUFBQVUsR0FDQSxTQUFBQyxHQUNBNUcsRUFBQStGLGNBQUEsRUFDQS9GLEVBQUFnRyxTQUFBLHlCQUlBaEcsRUFBQTZHLFFBQUEsU0FBQUMsR0FDQWhGLEVBQUFpRixJQUFBLE9BQUF6RCxLQUFBMEQsVUFBQUYsSUFDQWhGLEVBQUFpRixJQUFBLFFBQUF6RCxLQUFBMEQsV0FBQTlELFNBQUFsRCxFQUFBa0QsU0FBQUMsT0FBQW5ELEVBQUFtRCxVQUNBTixFQUFBb0UsV0FBQUgsR0FDQTdILEVBQUFpQyxTQUFBQyxLQUFBLFdBR0FuQixFQUFBa0gsS0FBQSxXQUNBdkcsUUFBQUMsSUFBQVosRUFBQWlHLE9BQ0FqRyxFQUFBcUcsZ0JDOUNBdkgsUUFBQUMsT0FBQSxPQUNBb0ksT0FBQSxtQkFBQSxXQUNBLE1BQUEsVUFBQWxCLEVBQUFtQixHQUNBLEdBQUF0SSxRQUFBdUksUUFBQXBCLEdBQUEsQ0FHQSxJQUFBLEdBRkFxQixNQUNBQyxLQUNBckMsRUFBQSxFQUFBQSxFQUFBZSxFQUFBZCxPQUFBRCxJQUFBLENBQ0EsR0FBQXNDLEdBQUF2QixFQUFBZixHQUFBa0MsRUFDQXRJLFNBQUEySSxZQUFBRixFQUFBQyxNQUNBRCxFQUFBQyxJQUFBLEVBQ0FGLEVBQUE1SCxLQUFBdUcsRUFBQWYsS0FHQSxNQUFBb0MsR0FFQSxNQUFBckIsTUNmQW5ILFFBQUFDLE9BQUEsT0FDQTJJLFFBQUEsZUFBQSxRQUFBLEtBQUEsU0FBQUMsRUFBQTVILEdBS0EsUUFBQTZILEtBQ0EsR0FBQXRJLEdBQUF1SSxPQUFBeEksYUFBQXlJLFFBQUFDLEVBQ0FwSCxTQUFBQyxJQUFBLHdCQUNBdEIsR0FDQTBJLEVBQUExSSxHQUdBLFFBQUEySSxLQUNBQyxFQUFBQyxPQUNBMUgsR0FBQSxFQUNBa0gsRUFBQVMsU0FBQWhKLFFBQUFpSixPQUFBLGNBQUFGLE9BQ0FOLE9BQUF4SSxhQUFBaUosV0FBQVAsR0FHQSxRQUFBUSxHQUFBakosR0FDQXVJLE9BQUF4SSxhQUFBbUosUUFBQVQsRUFBQXpJLEdBQ0EwSSxFQUFBMUksR0FHQSxRQUFBMEksR0FBQTFJLEdBQ0FtQixHQUFBLEVBQ0F5SCxFQUFBNUksRUFDQXFJLEVBQUFTLFNBQUFoSixRQUFBaUosT0FBQSxjQUFBSCxFQTFCQSxHQUVBQSxHQUZBSCxFQUFBLFFBQ0F0SCxHQUFBLEVBNEJBQyxFQUFBLFNBQUFHLEdBQ0EsTUFBQWQsR0FBQSxTQUFBMEksRUFBQUMsR0FDQWYsRUFBQWdCLEtBQUEsb0JBQUE5SCxHQUFBQyxLQUFBLFNBQUF3RyxHQUNBQSxFQUFBM0YsS0FBQVgsU0FDQXVILEVBQUFqQixFQUFBM0YsS0FBQXJDLE9BQ0FtSixFQUFBbkIsRUFBQTNGLEtBQUFaLElBQUF1RyxFQUFBM0YsS0FBQVgsVUFFQTBILEVBQUFwQixFQUFBM0YsS0FBQVosSUFBQXVHLEVBQUEzRixLQUFBWCxjQVFBSyxFQUFBLFdBQ0E0RyxLQUdBdkcsRUFBQSxTQUFBYixHQUNBLE1BQUFkLEdBQUEsU0FBQTBJLEVBQUFDLEdBQ0FmLEVBQUFnQixLQUFBLGNBQUE5SCxHQUFBQyxLQUFBLFNBQUF3RyxHQUNBQSxFQUFBM0YsS0FBQVgsU0FDQUwsUUFBQUMsSUFBQSxvQkFDQTZILEVBQUFuQixFQUFBM0YsS0FBQVosTUFFQTJILEVBQUFwQixFQUFBM0YsS0FBQVosU0FNQTZHLElBRUEsSUFBQXRHLEdBQUEsV0FDQSxNQUFBdkIsR0FBQSxTQUFBMEksRUFBQUMsR0FDQWYsRUFBQW5FLElBQUEsaUJBQUExQyxLQUFBLFNBQUF3RyxHQUNBQSxFQUFBM0YsS0FBQVgsUUFDQXlILEVBQUFuQixFQUFBM0YsS0FBQVosS0FFQTJILEVBQUFwQixFQUFBM0YsS0FBQVosU0FNQSxRQUNBTCxPQUFBQSxFQUNBVyxRQUFBQSxFQUNBSyxPQUFBQSxFQUNBSixZQUFBQSxFQUNBYixnQkFBQUEsTUNsRkEzQixRQUFBQyxPQUFBLE9BQ0EySSxRQUFBLFlBQUEsS0FBQSxRQUFBLFNBQUEzSCxFQUFBNEgsR0FDQSxHQUdBVixHQUFBLFNBQUFILEdBQ0E4QixZQUFBOUIsR0FHQStCLEVBQUEsV0FDQSxNQUFBRCxjQUdBbkYsRUFBQSxXQUNBLE1BQUExRCxHQUFBLFNBQUEwSSxFQUFBQyxHQUNBZixFQUFBbkUsSUFBQSxrQkFBQTFDLEtBQUEsU0FBQXdHLEdBQ0FBLEVBQUEzRixLQUFBWCxRQUNBeUgsRUFBQW5CLEVBQUEzRixLQUFBb0IsUUFFQTJGLEVBQUFwQixFQUFBM0YsS0FBQWlGLFdBUUEsUUFDQUssV0FBQUEsRUFDQTRCLFFBQUFBLEVBQ0FwRixVQUFBQSxNQzlCQTNFLFFBQUFDLE9BQUEsT0FDQTJJLFFBQUEsZUFBQSxLQUFBLFFBQUEsU0FBQTNILEVBQUE0SCxHQUVBLEdBQUFyQixHQUFBLFNBQUEzRSxHQUNBLE1BQUE1QixHQUFBLFNBQUEwSSxFQUFBQyxHQUNBZixFQUFBZ0IsS0FBQSxpQkFBQWhILEdBQUFiLEtBQUEsU0FBQXdHLEdBQ0FBLEVBQUEzRixLQUFBWCxTQUNBTCxRQUFBQyxJQUFBLGtCQUNBNkgsRUFBQW5CLEVBQUEzRixLQUFBc0UsUUFFQXlDLEVBQUFwQixFQUFBM0YsS0FBQWlGLFdBTUEsUUFDQU4sU0FBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDIyLjA5LjIwMTYuXHJcbiAqL1xyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsnbmdSb3V0ZScsICd1aS5yb3V0ZXInLCAnbmdDb29raWVzJ10pO1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDExLjEwLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5mYWN0b3J5KCdhdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbiAoJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICdyZXF1ZXN0JzogZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdhdXRoSW50ZXJjZXB0b3InKTtcclxuICAgICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignLycsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL21haW4nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc2lnbnVwJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc2lnbnVwJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3NpZ25pbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc2lnbmluJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3VzZXJpbmZvJywge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdXNlcmluZm8nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvc3VjY2Vzc2Z1bFNpZ251cCcse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc3VjY2Vzc2Z1bFNpZ251cCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9vZmZlcicse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvb2ZmZXInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY29uZmlybWF0aW9uJyx7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9jb25maXJtYXRpb24nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5vdGhlcndpc2UoJy8nKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxNC4xMC4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignYXV0aEN0cmwnLCBmdW5jdGlvbiAoJHEsICRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCAkcm91dGUsICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlKSB7XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUucmVnZXggPSAnKFxcXFwrWzAtOV1cXFxcZHsxfSkqKFxcXFxzKSooWzAtOV1cXFxcZHsyfSkoXFxcXHMqKShbMC05XVxcXFxkezJ9KShcXFxccyopKFswLTldXFxcXGR7Mn0pJztcclxuXHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbiAoKXtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2lnbmluID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9naW4nKTtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbmluKCRzY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChtc2csIHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZj0nIy8nO1xyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNpZ25vdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ25vdXQoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5pc0xvZ2VkSW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvZ291dCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRVc2VySW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UuZ2V0VXNlckluZm8oKS50aGVuKGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlcmluZm8gPSBtc2c7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEZvcm0gPSBmdW5jdGlvbiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpZihpc1ZhbGlkKXtcclxuICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNpZ251cCgkc2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQb215xZtsbmllIHphcmVqZXN0cm93YW5vJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmPScjL3N1Y2Nlc3NmdWxTaWdudXAnO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2goZGF0YS5jb2RlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTAwMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJtaXRFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ1d5YnJhbnkgZW1haWwgamVzdCBqdcW8IHphcmVqZXN0cm93YW55LiBQcm9zesSZIHd5YnJhxIcgaW5ueS4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdVcHNzIGNvxZsgcG9zesWCbyBuaWUgdGFrLiBQcm9zesSZIHNwcsOzYm93YcSHIHDDs8W6bmllai4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnVXBzcyBjb8WbIHBvc3rFgm8gbmllIHRhay4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBww7PFum5pZWouJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3N1Ym1pdEVycm9yJywgZnVuY3Rpb24gKGVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvck1lc3NhZ2UpXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAxMS4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignY29uZmlybWF0aW9uQ3RybCcsIGZ1bmN0aW9uICgkcSwgJHdpbmRvdywgJGxvY2F0aW9uLCAkY29va2llcywgJHNjb3BlLCAkcm9vdFNjb3BlLCBBdXRoU2VydmljZSkge1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNTaWduZWRJbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkID8gJHNjb3BlLmlzU2lnbmVkSW4gPSB0cnVlIDogJHNjb3BlLmlzU2lnbmVkSW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNpZ25pbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2lnbmluKCRzY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChtc2csIHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuaXNMb2dlZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc1NpZ25lZEluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnd29ob2hvaG8nKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2LFgsSZZG55IGxvZ2luIGx1YiBoYXPFgm8nKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vVE9ETyB6cm9iaWVuaWUgcmVqZXN0cmFjamkobW/FvGUgcHJ6ZW5pZXNpZW5pZSBuYSBzaWdudXAgdmlldz8gZG8gcm96d2HFvGVuaWEpIGkgb2JzxYJ1Z2EgYsWCxJlkw7N3KG1vxbxlIGpha2/FmyBwb8WCxIVjennEhyBvYnlkd2EgbG9nb3dhbmlhIGkgcmVqZXN0cmFjamUgdyBqZWRubz8pXHJcbiAgICAgICAgLy9UT0RPIHBvcm9iaWVuaWUgaSBwcnpldGVzdG93YW5pZSByZWZlcmVuY2ppIHcgbW9uZ29kYiBpIHpyb2JpZW5pZSBub3dlaiBrb2xla2NqaSBpIHBvdHdpZXJkem9ueW1pIHJlemVyd2FjamFtaSh6YXN0YW5vd2nEhyBzacSZIG5hZCBiYXrEhSBkYW55Y2gpXHJcbiAgICAgICAgaW5pdCgpO1xyXG5cclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmRpcmVjdGl2ZSgnY29tcGFyZVRvJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgb3RoZXJNb2RlbFZhbHVlOiBcIj1jb21wYXJlVG9cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgbmdNb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY29tcGFyZVRvID0gZnVuY3Rpb24obW9kZWxWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09IHNjb3BlLm90aGVyTW9kZWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwib3RoZXJNb2RlbFZhbHVlXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA4LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdvZmZlckN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkY29va2llcywgJGxvY2F0aW9uLCAkd2luZG93LCBvZmZlclN2Yykge1xyXG4gICAgICAgICRzY29wZS5vZmZlciA9IHt9O1xyXG4gICAgICAgICRzY29wZS5leHRyYXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMgPSBbXTtcclxuICAgICAgICB2YXIgZGF0ZXMgPSB7fTtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSAnJztcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLnJvb21OYW1lID0gJyc7XHJcblxyXG5cclxuICAgICAgICB2YXIgc2hvd09mZmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUub2ZmZXIgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgncm9vbScpKTtcclxuICAgICAgICAgICAgJHNjb3BlLmV4dHJhcyA9IGdldEV4dHJhcygpO1xyXG5cclxuICAgICAgICAgICAgZGF0ZXMgPSBKU09OLnBhcnNlKCRjb29raWVzLmdldCgnZGF0ZXMnKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlRnJvbSA9IGRhdGVQcmVldGlmeShuZXcgRGF0ZShkYXRlcy5kYXRlRnJvbSkpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZVRvID0gZGF0ZVByZWV0aWZ5KG5ldyBEYXRlKGRhdGVzLmRhdGVUbykpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnJvb21OYW1lID0gJHNjb3BlLm9mZmVyLnR5cGU7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tUHJpY2UgPSAkc2NvcGUub2ZmZXIucHJpY2U7XHJcbiAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlID0gMDtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRhdGVQcmVldGlmeSA9IGZ1bmN0aW9uIChkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcclxuICAgICAgICAgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRVVENNb250aCgpICsgMTtcclxuICAgICAgICAgICAgdmFyIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XHJcbiAgICAgICAgICAgIHJldHVybiAnJytkYXkrJy0nK21vbnRoKyctJyt5ZWFyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5hZGRPclJlbW92ZUV4dHJhID0gZnVuY3Rpb24gKGV4dHJhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMuaW5kZXhPZihleHRyYSk7XHJcbiAgICAgICAgICAgIGV4dHJhLmJ1dHRvblRleHQgPSBleHRyYS5idXR0b25Ub2dnbGUgPyAnRG9kYWogKycgOiAnVXN1xYQgLSc7XHJcbiAgICAgICAgICAgIGV4dHJhLmJ1dHRvblRvZ2dsZSA9ICFleHRyYS5idXR0b25Ub2dnbGU7XHJcblxyXG4gICAgICAgICAgICBpZihpbmRleCA9PSAtMSl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeHRyYXMucHVzaChleHRyYSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzVG90YWxQcmljZSArPSAoZXh0cmEucHJpY2UgKiBjYWxjdWxhdGVEaWZmT2ZEYXlzKCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXh0cmFzLnNwbGljZShpbmRleCwxKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXNUb3RhbFByaWNlIC09IChleHRyYS5wcmljZSAqIGNhbGN1bGF0ZURpZmZPZkRheXMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG9Db25maXJtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhc2Rhc2QnKTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvY29uZmlybWF0aW9uJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS50b1ByZXZpb3VzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIy9tYWluJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRyYXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG9mZmVyU3ZjLmdldEV4dHJhcygpLnRoZW4oZnVuY3Rpb24gKGV4dHJhc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leHRyYXMgPSBleHRyYXNEYXRhO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMCA7IGkgPCAkc2NvcGUuZXh0cmFzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXh0cmFzW2ldLmJ1dHRvblRleHQgPSAnRG9kYWogKyc7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dHJhc1tpXS5idXR0b25Ub2dnbGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNhbGN1bGF0ZURpZmZPZkRheXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBNU19QRVJfREFZID0gMTAwMCAqIDYwICogNjAgKiAyNDtcclxuICAgICAgICAgICAgdmFyIGRhdGVGcm9tID0gbmV3IERhdGUoZGF0ZXMuZGF0ZUZyb20pO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZVRvID0gbmV3IERhdGUoZGF0ZXMuZGF0ZVRvKTtcclxuICAgICAgICAgICAgdmFyIGRhdGVGcm9tVVRDID0gRGF0ZS5VVEMoZGF0ZUZyb20uZ2V0RnVsbFllYXIoKSwgZGF0ZUZyb20uZ2V0TW9udGgoKSwgZGF0ZUZyb20uZ2V0RGF0ZSgpKTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUb1VUQyA9IERhdGUuVVRDKGRhdGVUby5nZXRGdWxsWWVhcigpLCBkYXRlVG8uZ2V0TW9udGgoKSwgZGF0ZVRvLmdldERhdGUoKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKChkYXRlVG9VVEMgLSBkYXRlRnJvbVVUQykgLyBNU19QRVJfREFZKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzaG93T2ZmZXIoKTtcclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwNi4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcigncm9vbUN0cmwnLCBmdW5jdGlvbiAoJHEsICRjb29raWVzLCAkc2NvcGUsICR3aW5kb3csICRsb2NhdGlvbiwgcm9vbVNlcnZpY2UsIG9mZmVyU3ZjLCRmaWx0ZXIpIHtcclxuICAgICAgICAkc2NvcGUuZGF0ZUZyb20gPSAnJztcclxuICAgICAgICAkc2NvcGUuZGF0ZVRvID0gJyc7XHJcbiAgICAgICAgJHNjb3BlLm5vUm9vbXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5lcnJvck1zZyA9Jyc7XHJcbiAgICAgICAgJHNjb3BlLnJvb21zID0gW107XHJcbiAgICAgICAgJHNjb3BlLm51bWJlck9mQmVkcyA9IDE7XHJcblxyXG5cclxuICAgICAgICB2YXIgc2V0RGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRlKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVGcm9tID0gZGF0ZTtcclxuICAgICAgICAgICAgdmFyIGRhdGVUZW1wID0gbmV3IERhdGU7XHJcbiAgICAgICAgICAgIGRhdGVUZW1wLnNldERhdGUoZGF0ZVRlbXAuZ2V0RGF0ZSgpKzEpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZVRvID0gZGF0ZVRlbXA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNldERhdGUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmZpbmRSb29tcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5maW5kUm9vbXMgPSBmdW5jdGlvbiAoKSB7Ly9UT0RPIFd5xZt3aWV0bGVuaWUgZXJyb3JhIG8gYnJha3UgcG9rb2ppIG8gd3licmFueWNoIHBhcmFtZXRyYWNoIHXFvHl3YWrEhWMgbm9Sb29tc0Vycm9yIGkgbmctSGlkZVxyXG4gICAgICAgICAgICByb29tU2VydmljZS5nZXRSb29tcyh7XHJcbiAgICAgICAgICAgICAgICBmcm9tOiAkc2NvcGUuZGF0ZUZyb20udG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHRvOiAkc2NvcGUuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICBiZWRzOiAkc2NvcGUubnVtYmVyT2ZCZWRzXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJvb21zRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJvb21zID0gcm9vbXNEYXRhO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5ub1Jvb21zRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTXNnID0gJ0NvxZsgcG9zesWCbyBuaWUgdGFrLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZFJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoJ3Jvb20nLCBKU09OLnN0cmluZ2lmeShyb29tKSk7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgnZGF0ZXMnLCBKU09OLnN0cmluZ2lmeSh7ZGF0ZUZyb206ICRzY29wZS5kYXRlRnJvbSwgZGF0ZVRvOiAkc2NvcGUuZGF0ZVRvfSkpO1xyXG4gICAgICAgICAgICBvZmZlclN2Yy5jaG9vc2VSb29tKHJvb20pO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWY9JyMvb2ZmZXInO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucm9vbXMpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZmluZFJvb21zKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IFBpb3RyIFVzemxlciBvbiAwNy4xMS4yMDE2LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuZmlsdGVyKCd1bmlxdWVDYXRlZ29yaWVzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAocm9vbXMsIHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzQXJyYXkocm9vbXMpKXtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0ge307XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcm9vbXMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSByb29tc1tpXVtwcm9wZXJ0eU5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZChrZXlzW3ZhbF0pKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5c1t2YWxdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocm9vbXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcm9vbXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBQaW90ciBVc3psZXIgb24gMTQuMTAuMjAxNi5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLnNlcnZpY2UoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckcScsIGZ1bmN0aW9uICgkaHR0cCwgJHEpIHtcclxuICAgICAgICB2YXIgTE9DQUxfVE9LRU4gPSAndG9rZW4nO1xyXG4gICAgICAgIHZhciBpc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcclxuICAgICAgICB2YXIgYXV0aFRva2VuO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2FkVXNlckluZm8oKSB7XHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShMT0NBTF9UT0tFTik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2FkaW5nIFVzZXIgaW5mby4uLicpOy8vRG8gdXN1bmnEmWNpYVxyXG4gICAgICAgICAgICBpZih0b2tlbilcclxuICAgICAgICAgICAgICAgIHVzZXJJbmZvKHRva2VuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lVc2VySW5mbygpIHtcclxuICAgICAgICAgICAgYXV0aFRva2VuID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKExPQ0FMX1RPS0VOKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3JlVXNlckluZm8odG9rZW4pIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKExPQ0FMX1RPS0VOLCB0b2tlbik7XHJcbiAgICAgICAgICAgIHVzZXJJbmZvKHRva2VuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVzZXJJbmZvKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGF1dGhUb2tlbiA9IHRva2VuO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gYXV0aFRva2VuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHNpZ25pbiA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2F1dGhlbnRpY2F0ZScsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9yZVVzZXJJbmZvKHJlc3VsdC5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5tc2csIHJlc3VsdC5kYXRhLnN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5tc2csIHJlc3VsdC5kYXRhLnN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHZhciBzaWdub3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBkZXN0cm95VXNlckluZm8oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2lnbnVwID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvc2lnbnVwJywgdXNlcikudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdqZXN0ZW0gdyByZXNvbHZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxvYWRVc2VySW5mbygpO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckluZm8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdXNlcmluZm8nKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZGF0YS5zdWNjZXNzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YS5tc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZGF0YS5tc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBzaWduaW46IHNpZ25pbixcclxuICAgICAgICAgICAgc2lnbm91dDogc2lnbm91dCxcclxuICAgICAgICAgICAgc2lnbnVwOiBzaWdudXAsXHJcbiAgICAgICAgICAgIGdldFVzZXJJbmZvOiBnZXRVc2VySW5mbyxcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBpc0F1dGhlbnRpY2F0ZWRcclxuICAgICAgICB9XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA4LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdvZmZlclN2YycsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcclxuICAgICAgICB2YXIgY2hvc2VuUm9vbSA9IHt9O1xyXG4gICAgICAgIHZhciBleHRyYXMgPSBbXTtcclxuXHJcbiAgICAgICAgdmFyIGNob29zZVJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBjaG9vc2VuUm9vbSA9IHJvb207XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFJvb20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjaG9vc2VuUm9vbTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0cmFzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2dldEV4dHJhcycpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5kYXRhLnN1Y2Nlc3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLmV4dHJhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdC5kYXRhLmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBjaG9vc2VSb29tOiBjaG9vc2VSb29tLFxyXG4gICAgICAgICAgICBnZXRSb29tOiBnZXRSb29tLFxyXG4gICAgICAgICAgICBnZXRFeHRyYXM6IGdldEV4dHJhcyxcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgUGlvdHIgVXN6bGVyIG9uIDA2LjExLjIwMTYuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdyb29tU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcclxuXHJcbiAgICAgICAgdmFyIGdldFJvb21zID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvZmluZFJvb21zJywgZGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmRhdGEuc3VjY2Vzcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQb2JyYW5vIHBva29qZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhLnJvb21zKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0LmRhdGEuZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRSb29tczogZ2V0Um9vbXNcclxuICAgICAgICB9XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
